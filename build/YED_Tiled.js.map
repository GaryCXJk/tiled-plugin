{"version":3,"sources":["webpack:///webpack/bootstrap 3f52d86c3f1abba36b6e","webpack:///./src/TiledTilemap.js","webpack:///./src/index.js","webpack:///./src/TilesetManager.js","webpack:///./src/DataManager.js","webpack:///./src/ImageManager.js","webpack:///./src/TiledManager.js","webpack:///./src/Sprite_TiledPriorityTile.js","webpack:///./src/AlphaFilter.js","webpack:///./src/TiledTileLayer.js","webpack:///./src/TiledTileShader.js","webpack:///./src/Game_Map.js","webpack:///./src/Game_Screen.js","webpack:///./src/Game_CharacterBase.js","webpack:///./src/Game_Actor.js","webpack:///./src/Game_Player.js","webpack:///./src/Game_Vehicle.js","webpack:///./src/Game_Interpreter.js","webpack:///./src/Sprite_Character.js","webpack:///./src/Spriteset_Map.js"],"names":["TiledTilemap","tiledData","_tiledData","_layers","_parallaxlayers","_priorityTiles","_priorityTilesCount","setupTiled","_setupSize","_setupAnim","width","_width","height","_height","margin","_margin","tileCols","Math","ceil","_tileWidth","tileRows","_tileHeight","tilewidth","tileheight","_layerWidth","_layerHeight","_mapWidth","_mapHeight","_animFrame","_animDuration","id","_needsRepaint","parameters","PluginManager","useSquareShader","Number","hasOwnProperty","layers","layerData","zIndex","type","_createImageLayer","properties","parseInt","collision","toLevel","regionId","tileFlags","layer","layerId","spriteId","Sprite","_counter","alpha","opacity","push","addChild","_createPriorityTiles","pluginParams","size","Array","keys","x","sprite","Sprite_TiledPriorityTile","z","hide","renderer","bitmaps","map","_baseTexture","PIXI","Texture","setBitmaps","_updateAnim","needRefresh","key","refresh","startX","startY","ox","oy","roundPixels","floor","origin","y","offsetX","offsetx","offsetY","offsety","position","origX","origY","clear","_paintTiles","_paintObjectLayers","length","visible","_paintTilesLayer","objects","obj","gid","tileId","textureId","_getTextureId","dx","dy","positionHeight","_paintPriorityTile","_paintTile","mx","my","horizontalWrap","mod","verticalWrap","tilePosition","TiledManager","extractTileId","rectLayer","children","tileset","tilesets","w","h","columns","rId","_getAnimTileId","firstgid","ux","uy","_isPriorityTile","tileproperties","addRect","anchor","bitmap","setFrame","priority","_getPriority","_getZIndex","show","tilecount","tilesData","tiles","animation","frame","duration","tileid","playerZIndex","level","layerIds","hideOnLevel","transition","isShown","minAlpha","transitionStep","removeChild","forEach","indexOf","hideLayer","checkLayerHidden","hasHideProperties","props","$gameMap","getLayerProperties","transitionPhase","a","b","repeatX","repeatY","deltaX","deltaY","autoX","autoY","hue","viewportX","viewportY","viewportWidth","viewportHeight","viewportDeltaX","viewportDeltaY","ignoreLoading","Sprite_Base","TilingSprite","move","Graphics","ImageManager","loadParserParallax","image","addLoadListener","imageWidth","imageHeight","baseX","baseY","stepAutoX","stepAutoY","layerMask","baseWidth","baseHeight","mask","hasViewport","visibility","baseAlpha","offsets","tileWidth","tileHeight","display","displayX","displayY","autoXFunction","autoYFunction","beginFill","drawRect","val","ShaderTilemap","addListener","Game_Player","options","d","direction","$gameParty","members","actor","checkFloorEffect","moveStraight","addHideFunction","currentMapLevel","showOnLevel","$gamePlayer","hideOnRegion","hideOnRegions","split","String","regionIds","regions","filter","region","$gameSwitches","value","hideOnSwitch","showOnSwitch","addFlag","createVehicle","setAutoFunction","sin","PI","cos","addPluginCommand","args","mapId","waypoint","fadeType","isNaN","toLowerCase","reserveTransfer","setWaitMode","getParameterFlags","getParameterVehicles","TilesetManager","Error","window","_getFilename","path","paths","_getRealPath","getTileset","realPath","loadTileset","callback","xhr","XMLHttpRequest","open","overrideMimeType","onreadystatechange","readyState","status","responseText","JSON","parse","send","DataManager","_tempTiledData","_tiledLoaded","_loadMapData","loadMapData","call","loadTiledMapData","unloadTiledMapData","idx","processTiledData","tiledLoaded","tilesRequired","source","realTileset","Object","assign","returnTileset","_isMapLoaded","isMapLoaded","defaultLoaded","loadParserTileset","loadEmptyBitmap","shift","filename","slice","join","loadNormalBitmap","_listeners","_hideFunctions","_hideIgnoreFunctions","collisions","levelChanges","_tileFlags","_tileFlagIndex","_vehicles","_vehiclesByIndex","_autoFunctions","_pluginCommands","_fullVehicleData","bgm","name","pan","pitch","volume","characterIndex","characterName","startMapId","_processEncoding","base64","data","decodedData","atob","newData","charCodeAt","objectName","event","recursive","triggerListener","object","constructor","top","proto","__proto__","ignore","parentLayer","$gameData","prototype","splice","apply","concat","encoding","encFunc","chunks","chunk","i","startx","starty","chunkIdx","flagIds","flagId","getFlag","getFlagNames","getFlagLocation","flag","bit","group","vehicleName","vehicleData","vehicle","Game_Vehicle","refreshVehicles","vehicles","getAllVehicles","returnVehicles","getVehicle","updateVehicles","update","identifier","functions","getAutoFunction","command","func","pluginCommand","initialize","arguments","create","updateVisibility","fragmentSrc","filters","AlphaFilter","glShaderKey","uniforms","uAlpha","Filter","TiledTileLayer","useSquare","texPerChild","gl","tiledTileShader","plugins","tilemap","maxTextures","shader","setObjectRenderer","bindShader","_globalMat","Matrix","_activeRenderTarget","projectionMatrix","copy","append","worldTransform","toArray","shadowColor","tempScale","_tempScale","ps","pointScale","projectionScale","abs","resolution","af","animationFrame","tileAnim","renderWebGL","CompositeRectTileLayer","GLBuffer","glCore","VertexArrayObject","squareShaderFrag","squareShaderVert","rectShaderFrag","rectShaderVert","TiledTileShader","vert","frag","shaderGenerator","generateFragmentSrc","vertSize","vertPerQuad","anim","stride","fillSamplers","vb","createVao","addIndex","indexBuffer","addAttribute","attributes","aVertexPosition","FLOAT","aTextureCoord","aFrame","aAnim","aTextureId","TilemapShader","defineProperty","Game_Map","get","configurable","varID","_currentMapLevel","$gameVariables","set","setValue","_setup","setup","_tiledInitialized","_levels","_collisionMap","_arrowCollisionMap","_regions","_mapLevelChange","_positionHeightChange","_collisionMapLayers","_arrowCollisionMapLayers","_regionsLayers","_mapLevelChangeLayers","_positionHeightChangeLayers","_tileFlagsLayers","_waypoints","_layerProperties","_autoSize","_autoSizeBorder","_offsets","_camera","focus","isTiledMap","$dataMap","_setupTiled","_refreshList","character","refreshBushDepth","isTiledInitialized","setRefreshDepth","_initializeMapProperties","_initializeInfiniteMap","_setLayerProperties","_initializeMapLevel","_setupCollision","_setupRegion","_setupMapLevelChange","_setupTileFlags","_setupTiledEvents","autoSize","border","infinite","_setMapSize","minX","minY","maxX","maxY","x1","y1","x2","y2","_cropInfiniteMap","min","max","autoBorder","autoSizeBorder","offset","limit","forward","vertical","o","s","realO","lineEmpty","empty","o2","coords","autoFunctions","layerProperties","minimumOpacity","autoSpeedX","funcX","autoFunctionX","autoFunction","tFuncX","both","Function","autoSpeedY","funcY","autoFunctionY","tFuncY","_initializeMapLevelData","dataTypes","defaultData","dataType","defaultValue","typeData","_setupCollisionFull","_setupCollisionArrow","halfWidth","halfHeight","isHalfTile","realX","ids","_getTileset","tileData","collisionUpLeft","collisionUpRight","collisionDownLeft","collisionDownRight","arrowImpassable","arrowCollisionMap","realBit","arrowImpassableDown","arrowImpassableLeft","arrowImpassableRight","arrowImpassableUp","regionMap","regionOffset","levelChangeMap","_setupPositionHeightChange","positionHeightChangeMap","floorHeight","tileFlagMap","_getTileFlags","_combineFlags","flags","flagNames","property","prop","toUpperCase","target","eventId","_events","loadSystemSettings","setLocation","locate","_tiledProperties","_regionId","allIds","index","regionLayer","regionValue","main","regionValues","hideData","getMapLevels","levels","sort","_checkPassage","checkPassage","render","arrows","arrowLayer","arrowValue","renderPassage","getPassageLayers","_isPassable","isPassable","collisionMap","collisionLayer","collisionValue","renderIsPassable","getIsPassableLayers","checkMapLevelChanging","mapLevelChange","mapLevelChangeLayer","mapLevelChangeValue","oldValue","oldLevel","newLevel","checkPositionHeight","positionHeightChange","positionHeightChangeLayer","positionHeightChangeValue","getTileFlags","tileFlagsLayer","tileFlagsValue","renderTileFlags","getTileFlagLayers","checkHasTileFlag","renderHasTileFlag","_isBoatPassable","isBoatPassable","renderIsBoatPassable","_isShipPassable","isShipPassable","renderIsShipPassable","_isAirshipLandOk","isAirshipLandOk","renderIsAirshipLandOk","_isLadder","isLadder","isValid","renderIsLadder","_isBush","isBush","renderIsBush","_isCounter","isCounter","renderIsCounter","_isDamageFloor","isDamageFloor","renderIsDamageFloor","isSlipperyFloor","renderIsSlipperyFloor","_isHealFloor","isHealFloor","ignoreHidden","getTileProperties","tileProperties","_createVehicles","createVehicles","_refreshVehicles","refereshVehicles","getNames","_vehicle","_boat","boat","_ship","ship","_airship","airship","_updateVehicles","_update","sceneActive","setLayerProperties","autoDuration","Game_Screen","startFlashForHeal","startFlash","Game_CharacterBase","screenZ","_priorityType","_distancePerFrame","distancePerFrame","distance","_refreshBushDepth","_bushDepth","_updateMove","updateMove","hori","_realX","_x","_realY","_y","isMoving","newLocationHeight","_locationHeight","locationHeight","_isCollideWithVehicles","isCollidedWithVehicles","hasCollision","posNt","updateScroll","lastScrolledX","lastScrolledY","scrolledX","scrolledY","centerY","scrollDown","centerX","scrollLeft","scrollRight","scrollUp","_checkFloorEffect","Game_Actor","isOnHealFloor","executeFloorHeal","heal","basicFloorHeal","fdr","maxFloorHeal","gainHp","performMapHeal","_getFloorHPCalculation","typeName","floorHP","tile","actualHP","hp","round","pop","basicFloorDamage","actualDamage","actualHeal","mhp","inBattle","$gameScreen","_initMembers","initMembers","_newWaypoint","_checkEventTriggerHere","checkEventTriggerHere","triggers","_checkMapLevelChangingHere","isInAirship","_getOnVehicle","getOnVehicle","roundXWithDirection","roundYWithDirection","pos","_vehicleType","isInVehicle","_vehicleGettingOn","forceMoveForward","gatherFollowers","_isInVehicle","_reserveTransfer","performTransfer","isTransferring","setDirection","_newDirection","_newMapId","_needsMapReload","newX","_newX","newY","_newY","clearTransferInfo","_clearTransferInfo","_initialize","_initMoveSpeed","initMoveSpeed","moveSpeed","setMoveSpeed","_isMapPassable","isMapPassable","isBoat","isShip","isAirship","tileFlag","$dataSystem","_mapId","setPosition","setImage","_resetDirection","resetDirection","getOff","_driving","setWalkAnime","setStepAnime","$gameSystem","replayWalkingBgm","_pluginCommand","Game_Interpreter","Sprite_Character","_character","Spriteset_Battle","_parallaxContainers","_createTilemap","Spriteset_Map","createTilemap","_tilemap","isLoopHorizontal","isLoopVertical","_baseSprite","_loadTileset","refreshTileset","_tileset","_updateHideOnSpecial","updateParallax","updateTileset","_updateHideOnLevel","hideOnSpecial"],"mappings":"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","file":"YED_Tiled.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3f52d86c3f1abba36b6e","import TiledTileLayer from \"./TiledTileLayer\";\r\n\r\nexport class TiledTilemap extends ShaderTilemap {\r\n    initialize(tiledData) {\r\n        this._tiledData = {};\r\n        this._layers = [];\r\n        this._parallaxlayers = [];\r\n        this._priorityTiles = [];\r\n        this._priorityTilesCount = 0;\r\n        this.tiledData = tiledData;\r\n        super.initialize();\r\n        this.setupTiled();\r\n    }\r\n\r\n    get tiledData() {\r\n        return this._tiledData;\r\n    }\r\n\r\n    set tiledData(val) {\r\n        this._tiledData = val;\r\n        this.setupTiled();\r\n    }\r\n\r\n    setupTiled() {\r\n        this._setupSize();\r\n        this._setupAnim();\r\n    }\r\n\r\n    _setupSize() {\r\n        let width = this._width;\r\n        let height = this._height;\r\n        let margin = this._margin;\r\n        let tileCols = Math.ceil(width / this._tileWidth) + 1;\r\n        let tileRows = Math.ceil(height / this._tileHeight) + 1;\r\n        this._tileWidth = this.tiledData.tilewidth;\r\n        this._tileHeight = this.tiledData.tileheight;\r\n        this._layerWidth = tileCols * this._tileWidth;\r\n        this._layerHeight = tileRows * this._tileHeight;\r\n        this._mapWidth = this.tiledData.width;\r\n        this._mapHeight = this.tiledData.height;\r\n    }\r\n\r\n    _setupAnim() {\r\n        this._animFrame = {};\r\n        this._animDuration = {};\r\n    }\r\n\r\n    _createLayers() {\r\n        let id = 0;\r\n        this._needsRepaint = true;\r\n\r\n        let parameters = PluginManager.parameters('ShaderTilemap');\r\n        let useSquareShader = Number(parameters.hasOwnProperty('squareShader') ? parameters['squareShader'] : 1);\r\n\r\n        for (let layerData of this.tiledData.layers) {\r\n            let zIndex = 0;\r\n            if (layerData.type === \"imagelayer\") {\r\n                this._createImageLayer(layerData, id);\r\n                id++;\r\n                continue;\r\n            }\r\n            if (layerData.type != \"tilelayer\") {\r\n                id++;\r\n                continue;\r\n            }\r\n\r\n            if (!!layerData.properties && !!layerData.properties.zIndex) {\r\n                zIndex = parseInt(layerData.properties.zIndex);\r\n            }\r\n\r\n            if (!!layerData.properties && !!layerData.properties.collision) {\r\n                id++;\r\n                continue;\r\n            }\r\n\r\n            if (!!layerData.properties && !!layerData.properties.toLevel) {\r\n                id++;\r\n                continue;\r\n            }\r\n\r\n            if (!!layerData.properties && !!layerData.properties.regionId) {\r\n                id++;\r\n                continue;\r\n            }\r\n\r\n            if (!!layerData.properties && layerData.properties.tileFlags === 'hide') {\r\n                id++;\r\n                continue;\r\n            }\r\n\r\n            let layer = new TiledTileLayer(zIndex, [], useSquareShader, 32);\r\n            layer.layerId = id; // @dryami: hack layer index\r\n            layer.spriteId = Sprite._counter++;\r\n            layer.alpha = layerData.opacity;\r\n            this._layers.push(layer);\r\n            this.addChild(layer);\r\n            id++;\r\n        }\r\n\r\n        this._createPriorityTiles();\r\n    }\r\n\r\n    _createPriorityTiles() {\r\n        let pluginParams = PluginManager.parameters(\"YED_Tiled\");\r\n        let size = parseInt(pluginParams[\"Priority Tiles Limit\"]);\r\n        let zIndex = parseInt(pluginParams[\"Z - Player\"]);\r\n        for (let x of Array(size).keys()) {\r\n            let sprite = new Sprite_TiledPriorityTile();\r\n            sprite.z = sprite.zIndex = zIndex;\r\n            sprite.layerId = -1;\r\n            sprite.hide();\r\n            this.addChild(sprite);\r\n            this._priorityTiles.push(sprite);\r\n        }\r\n    }\r\n\r\n    _hackRenderer(renderer) {\r\n        return renderer;\r\n    }\r\n\r\n    refreshTileset() {\r\n        var bitmaps = this.bitmaps.map(function (x) { return x._baseTexture ? new PIXI.Texture(x._baseTexture) : x; });\r\n        for (let layer of this._layers) {\r\n            layer.setBitmaps(bitmaps);\r\n        }\r\n    }\r\n\r\n    update() {\r\n        super.update();\r\n        this._updateAnim();\r\n    }\r\n\r\n    _updateAnim() {\r\n        let needRefresh = false;\r\n        for (let key in this._animDuration) {\r\n            this._animDuration[key] -= 1;\r\n            if (this._animDuration[key] <= 0) {\r\n                this._animFrame[key] += 1;\r\n                needRefresh = true;\r\n            }\r\n        }\r\n\r\n        if (needRefresh) {\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    _updateLayerPositions(startX, startY) {\r\n        let ox = 0;\r\n        let oy = 0;\r\n        if (this.roundPixels) {\r\n            ox = Math.floor(this.origin.x);\r\n            oy = Math.floor(this.origin.y);\r\n        } else {\r\n            ox = this.origin.x;\r\n            oy = this.origin.y;\r\n        }\r\n\r\n        for (let layer of this._layers) {\r\n            let layerData = this.tiledData.layers[layer.layerId];\r\n            let offsetX = layerData.offsetx || 0;\r\n            let offsetY = layerData.offsety || 0;\r\n            layer.position.x = startX * this._tileWidth - ox + offsetX;\r\n            layer.position.y = startY * this._tileHeight - oy + offsetY;\r\n        }\r\n\r\n        for (let sprite of this._priorityTiles) {\r\n            let layerData = this.tiledData.layers[sprite.layerId];\r\n            let offsetX = layerData ? layerData.offsetx || 0 : 0;\r\n            let offsetY = layerData ? layerData.offsety || 0 : 0;\r\n            sprite.x = sprite.origX + startX * this._tileWidth - ox + offsetX + sprite.width / 2;\r\n            sprite.y = sprite.origY + startY * this._tileHeight - oy + offsetY + sprite.height;\r\n        }\r\n    }\r\n\r\n    _paintAllTiles(startX, startY) {\r\n        this._priorityTilesCount = 0;\r\n        for (let layer of this._layers) {\r\n            layer.clear();\r\n            this._paintTiles(layer, startX, startY);\r\n        }\r\n        let id = 0;\r\n        for (let layerData of this.tiledData.layers) {\r\n            if (layerData.type != \"objectgroup\") {\r\n                id++;\r\n                continue;\r\n            }\r\n            this._paintObjectLayers(id, startX, startY);\r\n            id++;\r\n        }\r\n        while (this._priorityTilesCount < this._priorityTiles.length) {\r\n            let sprite = this._priorityTiles[this._priorityTilesCount];\r\n            sprite.hide();\r\n            sprite.layerId = -1;\r\n            this._priorityTilesCount++;\r\n        }\r\n    }\r\n\r\n    _paintTiles(layer, startX, startY) {\r\n        let layerData = this.tiledData.layers[layer.layerId];\r\n\r\n        if (!layerData.visible) {\r\n            return;\r\n        }\r\n\r\n        if (layerData.type == \"tilelayer\") {\r\n            this._paintTilesLayer(layer, startX, startY);\r\n        }\r\n    }\r\n\r\n    _paintObjectLayers(layerId, startX, startY) {\r\n        let layerData = this.tiledData.layers[layerId];\r\n        let objects = layerData.objects || [];\r\n\r\n        for (let obj of objects) {\r\n            if (!obj.gid) {\r\n                continue;\r\n            }\r\n            if (!obj.visible) {\r\n                continue;\r\n            }\r\n            let tileId = obj.gid;\r\n            let textureId = this._getTextureId(tileId);\r\n            let dx = obj.x - startX * this._tileWidth;\r\n            let dy = obj.y - startY * this._tileHeight - obj.height;\r\n            let positionHeight = 0;\r\n            if(obj.properties && obj.properties.positionHeight) {\r\n                positionHeight = obj.properties.positionHeight;\r\n            }\r\n            this._paintPriorityTile(layerId, textureId, tileId, startX, startY, dx, dy, positionHeight);\r\n        }\r\n    }\r\n\r\n    _paintTilesLayer(layer, startX, startY) {\r\n        let tileCols = Math.ceil(this._width / this._tileWidth) + 1;\r\n        let tileRows = Math.ceil(this._height / this._tileHeight) + 1;\r\n\r\n        for (let y of Array(tileRows).keys()) {\r\n            for (let x of Array(tileCols).keys()) {\r\n                this._paintTile(layer, startX, startY, x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    _paintTile(layer, startX, startY, x, y) {\r\n        let mx = x + startX;\r\n        let my = y + startY;\r\n        if (this.horizontalWrap) {\r\n            mx = mx.mod(this._mapWidth);\r\n        }\r\n        if (this.verticalWrap) {\r\n            my = my.mod(this._mapHeight);\r\n        }\r\n        let tilePosition = mx + my * this._mapWidth;\r\n        let tileId = TiledManager.extractTileId(this.tiledData.layers[layer.layerId], tilePosition);\r\n        let rectLayer = layer.children[0];\r\n        let textureId = 0;\r\n\r\n        if (!tileId) {\r\n            return;\r\n        }\r\n\r\n        // TODO: Problem with offsets\r\n        if (mx < 0 || mx >= this._mapWidth || my < 0 || my >= this._mapHeight) {\r\n            return;\r\n        }\r\n\r\n        textureId = this._getTextureId(tileId);\r\n\r\n        let tileset = this.tiledData.tilesets[textureId];\r\n        let dx = x * this._tileWidth;\r\n        let dy = y * this._tileHeight;\r\n        let w = tileset.tilewidth;\r\n        let h = tileset.tileheight;\r\n        let tileCols = tileset.columns;\r\n        let rId = this._getAnimTileId(textureId, tileId - tileset.firstgid);\r\n        let ux = (rId % tileCols) * w;\r\n        let uy = Math.floor(rId / tileCols) * h;\r\n\r\n        if (this._isPriorityTile(layer.layerId)) {\r\n            let positionHeight = 0;\r\n            if(this.tiledData.layers[layer.layerId].properties.positionHeight) {\r\n                positionHeight+= this.tiledData.layers[layer.layerId].properties.positionHeight || 0\r\n            }\r\n            if(tileset.tileproperties &&\r\n                tileset.tileproperties[tileId - tileset.firstgid] &&\r\n                tileset.tileproperties[tileId - tileset.firstgid].positionHeight) {\r\n                positionHeight+= tileset.tileproperties[tileId - tileset.firstgid].positionHeight || 0\r\n            }\r\n            this._paintPriorityTile(layer.layerId, textureId, tileId, startX, startY, dx, dy, positionHeight);\r\n            return;\r\n        }\r\n\r\n        rectLayer.addRect(textureId, ux, uy, dx, dy, w, h);\r\n    }\r\n\r\n    _paintPriorityTile(layerId, textureId, tileId, startX, startY, dx, dy, positionHeight = 0) {\r\n        let tileset = this.tiledData.tilesets[textureId];\r\n        let w = tileset.tilewidth;\r\n        let h = tileset.tileheight;\r\n        let tileCols = tileset.columns;\r\n        let rId = this._getAnimTileId(textureId, tileId - tileset.firstgid);\r\n        let ux = (rId % tileCols) * w;\r\n        let uy = Math.floor(rId / tileCols) * h;\r\n        let sprite = this._priorityTiles[this._priorityTilesCount];\r\n        let layerData = this.tiledData.layers[layerId];\r\n        let offsetX = layerData ? layerData.offsetx || 0 : 0;\r\n        let offsetY = layerData ? layerData.offsety || 0 : 0;\r\n        let ox = 0;\r\n        let oy = 0;\r\n        if (this.roundPixels) {\r\n            ox = Math.floor(this.origin.x);\r\n            oy = Math.floor(this.origin.y);\r\n        } else {\r\n            ox = this.origin.x;\r\n            oy = this.origin.y;\r\n        }\r\n\r\n        if (this._priorityTilesCount >= this._priorityTiles.length) {\r\n            return;\r\n        }\r\n\r\n        sprite.layerId = layerId;\r\n        sprite.anchor.x = 0.5;\r\n        sprite.anchor.y = 1.0;\r\n        sprite.origX = dx;\r\n        sprite.origY = dy;\r\n        sprite.x = sprite.origX + startX * this._tileWidth - ox + offsetX + w / 2;\r\n        sprite.y = sprite.origY + startY * this._tileHeight - oy + offsetY + h;\r\n        sprite.bitmap = this.bitmaps[textureId];\r\n        sprite.setFrame(ux, uy, w, h);\r\n        sprite.priority = this._getPriority(layerId);\r\n        sprite.z = sprite.zIndex = this._getZIndex(layerId);\r\n        sprite.positionHeight = positionHeight;\r\n        sprite.show();\r\n\r\n        this._priorityTilesCount += 1;\r\n    }\r\n\r\n    _getTextureId(tileId) {\r\n        let textureId = 0;\r\n        for (let tileset of this.tiledData.tilesets) {\r\n            if (tileId < tileset.firstgid\r\n                || tileId >= tileset.firstgid + tileset.tilecount) {\r\n                textureId++;\r\n                continue;\r\n            }\r\n            break;\r\n        }\r\n        return textureId;\r\n    }\r\n\r\n    _getAnimTileId(textureId, tileId) {\r\n        let tilesData = this.tiledData.tilesets[textureId].tiles;\r\n        if (!tilesData) {\r\n            return tileId;\r\n        }\r\n        if (!tilesData[tileId]) {\r\n            return tileId;\r\n        }\r\n        if (!tilesData[tileId].animation) {\r\n            return tileId;\r\n        }\r\n        let animation = tilesData[tileId].animation;\r\n        this._animFrame[tileId] = this._animFrame[tileId] || 0;\r\n        let frame = this._animFrame[tileId];\r\n        this._animFrame[tileId] = !!animation[frame] ? frame : 0;\r\n        frame = this._animFrame[tileId];\r\n        let duration = animation[frame].duration / 1000 * 60;\r\n        this._animDuration[tileId] = this._animDuration[tileId] || duration;\r\n        if (this._animDuration[tileId] <= 0) {\r\n            this._animDuration[tileId] = duration;\r\n        }\r\n        return animation[frame].tileid;\r\n    }\r\n\r\n    _getPriority(layerId) {\r\n        let layerData = this.tiledData.layers[layerId];\r\n        if (!layerData.properties) {\r\n            return 0;\r\n        }\r\n        if (!layerData.properties.priority) {\r\n            return 0;\r\n        }\r\n        return parseInt(layerData.properties.priority)\r\n    }\r\n\r\n    _isPriorityTile(layerId) {\r\n        let pluginParams = PluginManager.parameters(\"YED_Tiled\");\r\n        let playerZIndex = parseInt(pluginParams[\"Z - Player\"]);\r\n        let zIndex = this._getZIndex(layerId);\r\n        return this._getPriority(layerId) > 0\r\n            && zIndex === playerZIndex;\r\n    }\r\n\r\n    _getZIndex(layerId) {\r\n        let layerData = this.tiledData.layers[layerId];\r\n        if (!layerData) {\r\n            return 0;\r\n        }\r\n        if (!layerData.properties || !layerData.properties.zIndex) {\r\n            return 0;\r\n        }\r\n        return parseInt(layerData.properties.zIndex);\r\n    }\r\n\r\n    hideOnLevel(level) {\r\n        let layerIds = [];\r\n        for (let layer of this._layers) {\r\n            let layerData = this.tiledData.layers[layer.layerId];\r\n            if (layerData.properties && layerData.properties.hasOwnProperty(\"hideOnLevel\")) {\r\n                if (parseInt(layerData.properties.hideOnLevel) !== level) {\r\n                    if(layer.transition) {\r\n                        /* If this layer has a transition, we'll need to tell the layer that\r\n                           it's supposed to be showing. */\r\n                           layer.isShown = true;\r\n                    }\r\n                    this.addChild(layer);\r\n                    continue;\r\n                }\r\n                /* Since the layer is supposed to be hidden, let's first let it transition if\r\n                   it has a transition fadeout. */\r\n                if(layer.transition) {\r\n                    layer.isShown = false;\r\n                    if(layer.minAlpha > 0 || layer.transitionStep > 0) {\r\n                        this.addChild(layer)\r\n                        continue;\r\n                    }\r\n                }\r\n                /* Otherwise remove the layer and hide it */\r\n                layerIds.push(layer.layerId);\r\n                this.removeChild(layer);\r\n            }\r\n        }\r\n        this._priorityTiles.forEach(sprite => {\r\n            if(layerIds.indexOf(sprite.layerId) > -1) {\r\n                sprite.visible = true;\r\n            }\r\n        })\r\n    }\r\n    \r\n    hideOnSpecial() {\r\n        for(let layer of this._layers) {\r\n            let layerData = this.tiledData.layers[layer.layerId];\r\n\t\t\tif(layerData.properties) {\r\n                let hideLayer = TiledManager.checkLayerHidden(layerData);\r\n                \r\n\t\t\t\t/* If the layer has a hide property, run this code.\r\n\t\t\t\t * You don't need to run it for layers that don't have any properties that would\r\n\t\t\t\t   hide this layer. */\r\n\t\t\t\tif (TiledManager.hasHideProperties(layerData)) {\r\n\t\t\t\t\t/* If the layer isn't supposed to be hidden, add the layer to the container */\r\n                    let props = $gameMap.getLayerProperties(layer.layerId);\r\n\t\t\t\t\tif (!hideLayer) {\r\n                        if(props.transition) {\r\n                            /* If this layer has a transition, we'll need to tell the layer that\r\n                               it's supposed to be showing. */\r\n                               props.isShown = true;\r\n                        }\r\n\t\t\t\t\t\tthis.addChild(layer);\r\n\t\t\t\t\t\tcontinue;\r\n                    }\r\n                    /* Since the layer is supposed to be hidden, let's first let it transition if\r\n                       it has a transition fadeout. */\r\n                    if(props.transition) {\r\n                        props.isShown = false;\r\n                        if(props.minAlpha > 0 || props.transitionPhase > 0) {\r\n                            this.addChild(layer)\r\n                            continue;\r\n                        }\r\n                    }\r\n                    /* Otherwise remove the layer and hide it */\r\n\t\t\t\t\tthis.removeChild(layer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n        }\r\n    }\r\n\t\r\n    _compareChildOrder(a, b) {\r\n        if((this._layers.indexOf(a) > -1 || this._parallaxlayers.indexOf(a) > -1) &&\r\n            (this._layers.indexOf(b) > -1 || this._parallaxlayers.indexOf(b) > -1)) {\r\n            if ((a.z || 0) !== (b.z || 0)) {\r\n                return (a.z || 0) - (b.z || 0);\r\n            } else if ((a.priority || 0) !== (b.priority || 0)) {\r\n                return (a.priority || 0) - (b.priority || 0);\r\n            } else if((a.layerId || 0) !== (b.layerId || 0)) {\r\n                return (a.layerId || 0) - (b.layerId || 0);\r\n            } else {\r\n                return a.spriteId - b.spriteId;\r\n            }\r\n        } else if ((a.z || 0) !== (b.z || 0)) {\r\n            return (a.z || 0) - (b.z || 0);\r\n        } else if (((a.y || 0) + (a.positionHeight || 0)) !== ((b.y || 0) + (b.positionHeight || 0))) {\r\n            return ((a.y || 0) + (a.positionHeight || 0)) - ((b.y || 0) + (b.positionHeight || 0));\r\n        } else if ((a.priority || 0) !== (b.priority || 0)) {\r\n            return (a.priority || 0) - (b.priority || 0);\r\n        } else {\r\n            return a.spriteId - b.spriteId;\r\n        }\r\n    }\r\n\r\n    /* Parallax map stuff */\r\n\r\n    _createImageLayer(layerData, id) {\r\n        let zIndex = 0;\r\n        let repeatX = false;\r\n        let repeatY = false;\r\n        let deltaX = 1;\r\n        let deltaY = 1;\r\n        let autoX = 0;\r\n        let autoY = 0;\r\n        let hue = 0;\r\n\t\tlet viewportX = 0;\r\n\t\tlet viewportY = 0;\r\n\t\tlet viewportWidth = 0;\r\n\t\tlet viewportHeight = 0;\r\n\t\tlet viewportDeltaX = 0;\r\n\t\tlet viewportDeltaY = 0;\r\n\r\n        let props = $gameMap.getLayerProperties(id);\r\n\r\n        if(!!layerData.properties) {\r\n            if(!!layerData.properties.ignoreLoading) {\r\n                return;\r\n            }\r\n            if (!!layerData.properties.zIndex) {\r\n                zIndex = parseInt(layerData.properties.zIndex);\r\n            }\r\n            if(layerData.properties.hasOwnProperty('repeatX')) {\r\n                repeatX = !!layerData.properties.repeatX;\r\n            }\r\n            if(layerData.properties.hasOwnProperty('repeatY')) {\r\n                repeatY = !!layerData.properties.repeatY;\r\n            }\r\n            if(layerData.properties.hasOwnProperty('deltaX')) {\r\n                deltaX = layerData.properties.deltaX;\r\n            }\r\n            if(layerData.properties.hasOwnProperty('deltaY')) {\r\n                deltaY = layerData.properties.deltaY;\r\n            }\r\n            if(!!layerData.properties.autoX) {\r\n                autoX = layerData.properties.autoX;\r\n            }\r\n            if(!!layerData.properties.autoY) {\r\n                autoY = layerData.properties.autoY;\r\n            }\r\n            if(!!layerData.properties.hue) {\r\n                hue = parseInt(layerData.properties.hue)\r\n            }\r\n\t\t\tif(layerData.properties.hasOwnProperty('viewportX')) {\r\n\t\t\t\tviewportX = layerData.properties.viewportX;\r\n\t\t\t}\r\n\t\t\tif(layerData.properties.hasOwnProperty('viewportY')) {\r\n\t\t\t\tviewportX = layerData.properties.viewportY;\r\n\t\t\t}\r\n\t\t\tif(layerData.properties.hasOwnProperty('viewportWidth')) {\r\n\t\t\t\tviewportWidth = layerData.properties.viewportWidth;\r\n\t\t\t}\r\n\t\t\tif(layerData.properties.hasOwnProperty('viewportHeight')) {\r\n\t\t\t\tviewportHeight = layerData.properties.viewportHeight;\r\n\t\t\t}\r\n\t\t\tif(layerData.properties.hasOwnProperty('viewportDeltaX')) {\r\n\t\t\t\tviewportDeltaX = layerData.properties.viewportDeltaX;\r\n\t\t\t}\r\n\t\t\tif(layerData.properties.hasOwnProperty('viewportDeltaY')) {\r\n\t\t\t\tviewportDeltaY = layerData.properties.viewportDeltaY;\r\n\t\t\t}\r\n        }\r\n\r\n        let layer;\r\n\r\n        if(!repeatX && !repeatY && !autoX && !autoY) {\r\n            layer = new Sprite_Base();\r\n        } else {\r\n            layer = new TilingSprite();\r\n            layer.move(0, 0, Graphics.width, Graphics.height);\r\n        }\r\n        layer.layerId = id;\r\n        layer.spriteId = Sprite._counter++;\r\n        layer.alpha = layerData.opacity;\r\n        layer.bitmap = ImageManager.loadParserParallax(layerData.image, hue);\r\n        layer.bitmap.addLoadListener(() => {\r\n            props.imageWidth = layer.bitmap.width;\r\n            props.imageHeight = layer.bitmap.height;\r\n        })\r\n        layer.baseX = layerData.x + (layerData.offsetx || 0);\r\n        layer.baseY = layerData.y + (layerData.offsety || 0);\r\n        layer.z = layer.zIndex = zIndex;\r\n        layer.repeatX = repeatX;\r\n        layer.repeatY = repeatY;\r\n        layer.deltaX = deltaX;\r\n        layer.deltaY = deltaY;\r\n        layer.stepAutoX = autoX;\r\n        layer.stepAutoY = autoY;\r\n        layer.autoX = 0;\r\n        layer.autoY = 0;\r\n\t\tif(viewportWidth || viewportHeight) {\r\n\t\t\tviewportWidth = viewportWidth || Graphics.width;\r\n\t\t\tviewportHeight = viewportHeight || Graphics.height;\r\n\t\t\tlet layerMask = new PIXI.Graphics();\r\n\t\t\tlayerMask.baseX = viewportX;\r\n\t\t\tlayerMask.baseY = viewportY;\r\n\t\t\tlayerMask.baseWidth = viewportWidth;\r\n\t\t\tlayerMask.baseHeight = viewportHeight;\r\n\t\t\tlayerMask.deltaX = viewportDeltaX;\r\n\t\t\tlayerMask.deltaY = viewportDeltaY;\r\n\t\t\tlayer.mask = layerMask;\r\n\t\t\tlayer.hasViewport = true;\r\n\t\t}\r\n        this._parallaxlayers.push(layer);\r\n        this.addChild(layer);\r\n    }\r\n\r\n    updateParallax() {\r\n        this._parallaxlayers.forEach(layer => {\r\n            let layerData = this.tiledData.layers[layer.layerId];\r\n            let props = $gameMap.getLayerProperties(layer.layerId);\r\n            if(TiledManager.hasHideProperties(layerData)) {\r\n                let visibility = TiledManager.checkLayerHidden(layerData);\r\n                if(props.transition) {\r\n                    layer.alpha = (((props.baseAlpha - props.minAlpha) * (props.transitionPhase / props.transition)) + props.minAlpha);\r\n                    visibility = props.minAlpha > 0 || props.transitionPhase > 0;\r\n                }\r\n                layer.visible = visibility;\r\n            }\r\n\t\t\tlet offsets = $gameMap.offsets();\r\n\t\t\toffsets.x*= $gameMap.tileWidth();\r\n            offsets.y*= $gameMap.tileHeight();\r\n            let display = {\r\n                x: $gameMap.displayX() * $gameMap.tileWidth() - offsets.x,\r\n                y: $gameMap.displayY() * $gameMap.tileHeight() - offsets.y\r\n            }\r\n            if(!!layer.origin) {\r\n                let autoX = props.autoXFunction ? props.autoXFunction(props.autoX, props.autoY || 0) : 0;\r\n                let autoY = props.autoYFunction ? props.autoYFunction(props.autoX || 0, props.autoY) : 0;\r\n                if(!layer.repeatX) {\r\n                    layer.origin.x = layer.baseX - offsets.x + autoX;\r\n                    layer.x = layer.baseX - offsets.x - display.x * layer.deltaX;\r\n                    layer.width = layer.bitmap.width;\r\n                } else {\r\n                    layer.origin.x = layer.baseX - offsets.x + autoX + display.x * layer.deltaX;\r\n                    layer.x = 0;\r\n                    layer.width = Graphics.width;\r\n                }\r\n                if(!layer.repeatY) {\r\n                    layer.origin.y = layer.baseY - offsets.y + autoY;\r\n                    layer.y = layer.baseY - offsets.y - display.y * layer.deltaY;\r\n                    layer.height = layer.bitmap.height;\r\n                } else {\r\n                    layer.origin.y = layer.baseY - offsets.y + autoY + display.y * layer.deltaY;\r\n                    layer.y = 0;\r\n                    layer.height = Graphics.height;\r\n                }\r\n            } else {\r\n                layer.x = layer.baseX - offsets.x - display.x * layer.deltaX;\r\n                layer.y = layer.baseY - offsets.y - display.y * layer.deltaY;\r\n            }\r\n\t\t\tif(layer.hasViewport) {\r\n\t\t\t\tlet viewportX = layer.mask.baseX - offsets.x - display.x * layer.mask.deltaX;\r\n\t\t\t\tlet viewportY = layer.mask.baseY - offsets.y - display.y * layer.mask.deltaY;\r\n\t\t\t\tlayer.mask.clear();\r\n\t\t\t\tlayer.mask.beginFill(0xffffff, 1);\r\n\t\t\t\tlayer.mask.drawRect(viewportX, viewportY, layer.mask.baseWidth, layer.mask.baseHeight);\r\n\t\t\t}\r\n        })\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/TiledTilemap.js","import \"./TilesetManager\";\r\nimport \"./DataManager\";\r\nimport \"./ImageManager\";\r\nimport \"./TiledManager\";\r\nimport \"./Sprite_TiledPriorityTile\";\r\nimport \"./AlphaFilter\";\r\nimport { TiledTilemap } from \"./TiledTilemap\";\r\nimport \"./Game_Map\";\r\nimport \"./Game_Screen\";\r\nimport \"./Game_CharacterBase\";\r\nimport \"./Game_Actor\";\r\nimport \"./Game_Player\";\r\nimport \"./Game_Vehicle\";\r\nimport \"./Game_Interpreter\";\r\nimport \"./Sprite_Character\";\r\nimport \"./Spriteset_Map\";\r\n\r\n/* INITIALIZES LISTENERS */\r\n\r\n// Add floor damage while on a slippery floor\r\nTiledManager.addListener(Game_Player, 'slipperyfloor', function(options) {\r\n    const d = options.direction\r\n    $gameParty.members().forEach(actor => {\r\n        actor.checkFloorEffect();\r\n    })\r\n    this.moveStraight(d);\r\n})\r\n\r\n/* INITIALIZES HIDE FUNCTIONS */\r\n\r\nTiledManager.addHideFunction('hideOnLevel', function(layerData) {\r\n    /* Hide if player is on certain level */\r\n    let level = $gameMap.currentMapLevel;\r\n    let hideLayer = false;\r\n    if(parseInt(layerData.properties.hideOnLevel) === level) {\r\n        hideLayer = true;\r\n    }\r\n    return hideLayer;\r\n});\r\n\r\nTiledManager.addHideFunction('showOnLevel', function(layerData) {\r\n    /* Show if player is on certain level */\r\n    let level = $gameMap.currentMapLevel;\r\n    let hideLayer = false;\r\n    if(parseInt(layerData.properties.showOnLevel) !== level) {\r\n        hideLayer = true;\r\n    }\r\n    return hideLayer;\r\n});\r\n\r\nTiledManager.addHideFunction('hideOnRegion', function(layerData) {\r\n    /* Hide if player is on certain region */\r\n    let regionId = $gamePlayer.regionId();\r\n    let hideLayer = false;\r\n    if(parseInt(layerData.properties.hideOnRegion) === regionId) {\r\n        hideLayer = true;\r\n    }\r\n    return hideLayer;\r\n}, ['regions'])\r\n\r\nTiledManager.addHideFunction('hideOnRegions', function(layerData) {\r\n    /* Hide if player is on certain region */\r\n    let regionId = $gamePlayer.regionId();\r\n    let hideLayer = false;\r\n    if(layerData.properties.hideOnRegions.split(',').indexOf(String(regionId)) !== -1) {\r\n        hideLayer = true;\r\n    }\r\n    return hideLayer;\r\n}, ['regions'])\r\n\r\nTiledManager.addHideFunction('hideOnAnyRegions', function(layerData) {\r\n    /* Hide if player is on certain region */\r\n    let regionIds = $gamePlayer.regionIds();\r\n    let hideLayer = false;\r\n    let regions = layerData.properties.hideOnRegions.split(',');\r\n    if(regions.filter(region => regionIds.indexOf(region) > -1).length > 0) {\r\n        hideLayer = true;\r\n    }\r\n    return hideLayer;\r\n}, ['regions'])\r\n\r\nTiledManager.addHideFunction('hideOnSwitch', function(layerData) {\r\n    /* Hide if switch is on */\r\n    let hideLayer = false;\r\n    if($gameSwitches.value(layerData.properties.hideOnSwitch)) {\r\n        hideLayer = true;\r\n    }\r\n    return hideLayer;\r\n})\r\n\r\nTiledManager.addHideFunction('showOnSwitch', function(layerData) {\r\n    /* Show if switch is on */\r\n    let hideLayer = false;\r\n    if(!$gameSwitches.value(layerData.properties.showOnSwitch)) {\r\n        hideLayer = true;\r\n    }\r\n    return hideLayer;\r\n})\r\n\r\n/* INITIALIZES FLAGS */\r\n\r\nTiledManager.addFlag('boat', 'ship', 'airship')\r\nTiledManager.addFlag('ladder', 'bush', 'counter', 'damage')\r\nTiledManager.addFlag('ice', 'autoDown', 'autoLeft', 'autoRight', 'autoUp')\r\nTiledManager.addFlag('heal')\r\n\r\n/* INITIALIZES VEHICLES */\r\n\r\nTiledManager.createVehicle('boat', true)\r\nTiledManager.createVehicle('ship', true)\r\nTiledManager.createVehicle('airship', true)\r\n\r\n/* INITIALIZES AUTO FUNCTIONS */\r\n\r\nTiledManager.setAutoFunction('linear', {\r\n    x: (x, y) => { return x; },\r\n    y: (x, y) => { return y; }\r\n})\r\n\r\nTiledManager.setAutoFunction('sine', {\r\n    x: (x, y) => { return Math.sin(x * Math.PI / 180); },\r\n    y: (x, y) => { return Math.sin(y * Math.PI / 180); }\r\n})\r\n\r\nTiledManager.setAutoFunction('cosine', {\r\n    x: (x, y) => { return Math.cos(x * Math.PI / 180); },\r\n    y: (x, y) => { return Math.cos(y * Math.PI / 180); }\r\n})\r\n\r\n/* INITIALIZES PLUGIN COMMANDS */\r\n\r\nTiledManager.addPluginCommand('TiledTransferPlayer', function(args) {\r\n    let mapId = parseInt(args[0]);\r\n    let waypoint = args[1];\r\n    let direction = args.length > 2 ? args[2] : 0;\r\n    let fadeType = args.length > 3 ? args[3] : 2;\r\n    if(isNaN(direction)) {\r\n        switch(direction.toLowerCase()) {\r\n            case 'down':\r\n                direction = 2;\r\n                break;\r\n            case 'left':\r\n                direction = 4;\r\n                break;\r\n            case 'right':\r\n                direction = 6;\r\n                break;\r\n            case 'up':\r\n                direction = 8;\r\n                break;\r\n            default:\r\n                direction = 0;\r\n                break;\r\n        }\r\n    } else {\r\n        direction = parseInt(direction);\r\n    }\r\n    if(isNaN(fadeType)) {\r\n        switch(direction.toLowerCase()) {\r\n            case 'black':\r\n                fadeType = 0;\r\n                break;\r\n            case 'white':\r\n                fadeType = 1;\r\n                break;\r\n            default:\r\n                fadeType = 2;\r\n                break;\r\n        }\r\n    } else {\r\n        fadeType = parseInt(fadeType);\r\n    }\r\n    $gamePlayer.reserveTransfer(mapId, 0, 0, direction, fadeType, waypoint);\r\n    this.setWaitMode('transfer');\r\n})\r\n\r\n/* LOAD CUSTOM DATA FROM THE PARAMTERS */\r\n\r\nTiledManager.getParameterFlags()\r\nTiledManager.getParameterVehicles()\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","//-----------------------------------------------------------------------------\r\n// TilesetManager\r\n//\r\n// The static class that manages the TileD tilesets.\r\n\r\nfunction TilesetManager() {\r\n    throw new Error('This is a static class');\r\n}\r\n\r\nwindow.TilesetManager = TilesetManager;\r\nTilesetManager.tilesets = {};\r\n\r\nlet _getFilename = function(path) {\r\n    let paths = path.split(\"/\");\r\n    return paths[paths.length - 1];\r\n};\r\n\r\nlet _getRealPath = function(path) {\r\n    let pluginParams = PluginManager.parameters(\"YED_Tiled\");\r\n    return pluginParams[\"Tilesets Location\"] + _getFilename(path);\r\n};\r\n\r\nTilesetManager.getTileset = function(path) {\r\n    let realPath = _getRealPath(path);\r\n    return TilesetManager.tilesets[_getFilename(path)];\r\n};\r\n\r\nTilesetManager.loadTileset = function(path, callback = false) {\r\n    let realPath = _getRealPath(path);\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open('GET', './' + realPath);\r\n    xhr.overrideMimeType('application/json');\r\n\r\n    // on success callback\r\n    xhr.onreadystatechange = function () {\r\n        if (xhr.readyState === 4) {\r\n            let tileset = false;\r\n            if (xhr.status === 200 || xhr.responseText !== \"\") {\r\n                tileset = JSON.parse(xhr.responseText);\r\n                TilesetManager.tilesets[_getFilename(path)] = tileset;\r\n            }\r\n            if(callback) {\r\n                callback(tileset);\r\n            }\r\n        }\r\n    };\r\n\r\n    // send request\r\n    xhr.send();\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/TilesetManager.js","DataManager._tempTiledData = null;\r\nDataManager._tiledLoaded = false;\r\n\r\nlet _loadMapData = DataManager.loadMapData;\r\nDataManager.loadMapData = function (mapId) {\r\n    _loadMapData.call(this, mapId);\r\n    if (mapId > 0) {\r\n        this.loadTiledMapData(mapId);\r\n    } else {\r\n        this.unloadTiledMapData();\r\n    }\r\n};\r\n\r\nDataManager.loadTiledMapData = function (mapId) {\r\n    var xhr = new XMLHttpRequest();\r\n    let pluginParams = PluginManager.parameters(\"YED_Tiled\");\r\n    xhr.open('GET', \"./\" + pluginParams[\"Maps Location\"] + \"Map\" + mapId + \".json\");\r\n    xhr.overrideMimeType('application/json');\r\n\r\n    // on success callback\r\n    xhr.onreadystatechange = function () {\r\n        if (xhr.readyState === 4) {\r\n            if (xhr.status === 200 || xhr.responseText !== \"\") {\r\n                DataManager._tempTiledData = JSON.parse(xhr.responseText);\r\n                TiledManager.processTiledData(DataManager._tempTiledData);\r\n            }\r\n            let tiledLoaded = true;\r\n            let tilesRequired = 0;\r\n            if(DataManager._tempTiledData && DataManager._tempTiledData.tilesets && DataManager._tempTiledData.tilesets.length > 0) {\r\n                for(var idx = 0; idx < DataManager._tempTiledData.tilesets.length; idx++) {\r\n                    let tileset = DataManager._tempTiledData.tilesets[idx];\r\n                    if(tileset.source) {\r\n                        let realTileset = TilesetManager.getTileset(tileset.source);\r\n                        if(realTileset) {\r\n                            DataManager._tempTiledData.tilesets[idx] = Object.assign({}, realTileset, {firstgid: DataManager._tempTiledData.tilesets[idx].firstgid});\r\n                        } else {\r\n                            tiledLoaded = false;\r\n                            tilesRequired++;\r\n                            +function(idx) {\r\n                                TilesetManager.loadTileset(tileset.source, function(returnTileset) {\r\n                                    DataManager._tempTiledData.tilesets[idx] = Object.assign({}, returnTileset, {firstgid: DataManager._tempTiledData.tilesets[idx].firstgid});\r\n                                    tilesRequired--;\r\n                                    if(tilesRequired === 0) {\r\n                                        DataManager._tiledLoaded = true;\r\n                                    }\r\n                                });\r\n                            }(idx);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            DataManager._tiledLoaded = tiledLoaded;\r\n        }\r\n    };\r\n\r\n    // set data to null and send request\r\n    this.unloadTiledMapData();\r\n    xhr.send();\r\n};\r\n\r\nDataManager.unloadTiledMapData = function () {\r\n    DataManager._tempTiledData = null;\r\n    DataManager._tiledLoaded = false;\r\n};\r\n\r\nlet _isMapLoaded = DataManager.isMapLoaded;\r\nDataManager.isMapLoaded = function() {\r\n    let defaultLoaded = _isMapLoaded.call(this);\r\n    let tiledLoaded = DataManager._tiledLoaded;\r\n\r\n    return defaultLoaded && tiledLoaded;\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/DataManager.js","ImageManager.loadParserTileset = function (path, hue) {\r\n    if (!path) {\r\n        return this.loadEmptyBitmap();\r\n    }\r\n    let paths = path.split(\"/\");\r\n    while(paths[0] === '..') {\r\n        paths.shift();\r\n    }\r\n    let filename = paths[paths.length - 1];\r\n    let realPath = \"img/tilesets/\" + filename;\r\n    if(paths[0] === 'img') {\r\n        realPath = paths.slice(0, -1).join('/') + '/' + filename;\r\n    }\r\n\r\n    return this.loadNormalBitmap(realPath, hue);\r\n};\r\n\r\nImageManager.loadParserParallax = function (path, hue) {\r\n    if (!path) {\r\n        return this.loadEmptyBitmap();\r\n    }\r\n    let paths = path.split(\"/\");\r\n    while(paths[0] === '..') {\r\n        paths.shift();\r\n    }\r\n    let filename = paths[paths.length - 1];\r\n    let realPath = \"img/parallaxes/\" + filename;\r\n    if(paths[0] === 'img') {\r\n        realPath = paths.slice(0, -1).join('/') + '/' + filename;\r\n    }\r\n\r\n    return this.loadNormalBitmap(realPath, hue);\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/ImageManager.js","//-----------------------------------------------------------------------------\r\n// TiledManager\r\n//\r\n// The static class that manages TileD data, including extensions.\r\n\r\nfunction TiledManager() {\r\n    throw new Error('This is a static class');\r\n}\r\n\r\nwindow.TiledManager = TiledManager;\r\n\r\nlet pluginParams = PluginManager.parameters(\"YED_Tiled\");\r\n\r\nlet _listeners = {}\r\nlet _hideFunctions = {}\r\nlet _hideIgnoreFunctions = {\r\n    regions: [],\r\n    collisions: [],\r\n    levelChanges: [],\r\n    tileFlags: []\r\n}\r\nlet _tileFlags = {}\r\nlet _tileFlagIndex = 1;\r\nlet _vehicles = {};\r\nlet _vehiclesByIndex = [];\r\n\r\nlet _autoFunctions = {};\r\n\r\nlet _pluginCommands = {};\r\n\r\nlet _fullVehicleData = {\r\n    bgm: {\r\n        name: '',\r\n        pan: 0,\r\n        pitch: 100,\r\n        volume: 90\r\n    },\r\n    characterIndex: 0,\r\n    characterName:\"\",\r\n    startMapId: 0,\r\n    startX: 0,\r\n    startY: 0\r\n};\r\n\r\nlet _processEncoding = {\r\n\tbase64: function(data) {\r\n\t\tlet decodedData = atob(data);\r\n\t\tlet newData = [];\r\n\t\tfor (let idx = 0; idx < decodedData.length; idx+= 4) {\r\n\t\t\tnewData.push(decodedData.charCodeAt(idx) | ((decodedData.charCodeAt(idx + 1) || 0) << 8) | ((decodedData.charCodeAt(idx + 2) || 0) << 16) | ((decodedData.charCodeAt(idx + 3) || 0) << 24));\r\n\t\t}\r\n\t\treturn newData;\r\n\t}\r\n};\r\n\r\nTiledManager.addListener = function(objectName, event, callback, recursive = true) {\r\n    if(typeof objectName === 'function') {\r\n        objectName = objectName.name\r\n    }\r\n    if(!_listeners[objectName]) {\r\n        _listeners[objectName] = {}\r\n    }\r\n    if(!_listeners[objectName][event]) {\r\n        _listeners[objectName][event] = []\r\n    }\r\n    callback.recursive = !!recursive\r\n    _listeners[objectName][event].push(callback)\r\n}\r\n\r\nTiledManager.triggerListener = function(object, event, options = {}) {\r\n    let objectName = object.constructor.name\r\n    if(!_listeners[objectName] || !_listeners[objectName][event]) {\r\n        return false\r\n    }\r\n    let top = true\r\n    let proto = object.__proto__\r\n    while(proto) {\r\n        objectName = proto.constructor.name\r\n        if(_listeners[objectName] && _listeners[objectName][event]) {\r\n            _listeners[objectName][event].forEach(callback => {\r\n                if(top || callback.recursive) {\r\n                    callback.call(object, options)\r\n                }\r\n            })\r\n        }\r\n        top = false\r\n        proto = proto.__proto__\r\n    }\r\n}\r\n\r\nTiledManager.addHideFunction = function(id, callback, ignore = []) {\r\n    _hideFunctions[id] = callback\r\n\r\n    ignore.forEach((type) => {\r\n        _hideIgnoreFunctions[type].push(id)\r\n    })\r\n}\r\n\r\nTiledManager.checkLayerHidden = function(layerData, ignore = []) {\r\n    if(typeof ignore === 'string') {\r\n        ignore = _hideIgnoreFunctions[ignore] || []\r\n    }\r\n    let keys = Object.keys(_hideFunctions);\r\n    let data = false;\r\n    for(let idx = 0; idx < keys.length; idx++) {\r\n        if(ignore.indexOf(keys) !== -1) {\r\n            continue;\r\n        }\r\n        if(layerData.properties && layerData.properties.hasOwnProperty(keys[idx])) {\r\n            data = data || _hideFunctions[keys[idx]](layerData);\r\n        }\r\n        if(data) {\r\n            return data;\r\n        }\r\n    }\r\n    return data;\r\n}\r\n\r\nTiledManager.hasHideProperties = function(layerData) {\r\n    return (layerData.properties && (\r\n        Object.keys(_hideFunctions).filter(key => {\r\n            return layerData.properties.hasOwnProperty(key)\r\n        }).length > 0)\r\n    );\r\n}\r\n\r\nTiledManager.processTiledData = function(parentLayer = false) {\r\n    if(!parentLayer) {\r\n        parentLayer = $gameData.tiledData\r\n    }\r\n    if(!parentLayer) {\r\n        return;\r\n    }\r\n    for(var idx = 0; idx < parentLayer.layers.length; idx++) {\r\n        let layer = parentLayer.layers[idx];\r\n        if(layer.type === 'group') {\r\n\t\t\tTiledManager.processTiledData(layer);\r\n\t\t\tArray.prototype.splice.apply(parentLayer.layers, [idx, 1].concat(layer.layers))\r\n\t\t\tidx+= layer.layers.length - 1;\r\n\t\t\tcontinue;\r\n        }\r\n\t\tif(layer.type === 'tilelayer') {\r\n\t\t\tlet encoding = layer.encoding || '';\r\n\t\t\tif(encoding && _processEncoding.hasOwnProperty(encoding)) {\r\n\t\t\t\tlet encFunc = _processEncoding[encoding];\r\n\t\t\t\tif(layer.data) {\r\n\t\t\t\t\tlayer.data = encFunc(layer.data);\r\n\t\t\t\t} else if(layer.chunks) {\r\n\t\t\t\t\tlayer.chunks.forEach(chunk => {\r\n\t\t\t\t\t\tchunk.data = encFunc(chunk.data);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n    }\r\n}\r\n\r\nTiledManager.extractTileId = function(layerData, i) {\r\n\tif(layerData.data) {\r\n\t\treturn layerData.data[i];\r\n\t} else {\r\n\t\tlet x = i % $gameMap.width();\r\n\t\tlet y = Math.floor(i / $gameMap.width());\r\n\t\tlet offsets = $gameMap.offsets();\r\n\t\tx+= offsets.x;\r\n\t\ty+= offsets.y;\r\n\t\tif(x < layerData.startx || y < layerData.starty || x >= layerData.startx + layerData.width || y >= layerData.starty + layerData.height) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tfor(let chunkIdx = 0; chunkIdx < layerData.chunks.length; chunkIdx++) {\r\n\t\t\tlet chunk = layerData.chunks[chunkIdx];\r\n\t\t\tif(x < chunk.x || y < chunk.y || x >= chunk.x + chunk.width || y >= chunk.y + chunk.height) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\treturn chunk.data[x - chunk.x + (y - chunk.y) * chunk.width];\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\n/* TILE FLAGS */\r\n\r\nTiledManager.addFlag = function(...flagIds) {\r\n    flagIds.forEach(flagId => {\r\n        _tileFlags[flagId] = _tileFlagIndex++;\r\n    })\r\n}\r\n\r\nTiledManager.getFlag = function(flagId) {\r\n    return _tileFlags[flagId];\r\n}\r\n\r\nTiledManager.getFlagNames = function() {\r\n    return Object.keys(_tileFlags);\r\n}\r\n\r\nTiledManager.getFlagLocation = function(flagId) {\r\n    let flag = _tileFlags[flagId]\r\n    let bit = (1 << (flag % 16)) & 0xffff;\r\n    let group = Math.floor(flag / 16);\r\n    return [group, bit];\r\n}\r\n\r\nTiledManager.getParameterFlags = function() {\r\n    if(!!pluginParams['Custom Tile Flags']) {\r\n        let tileFlags = JSON.parse(pluginParams['Custom Tile Flags']);\r\n        TiledManager.addFlag.apply(this, tileFlags);\r\n    }\r\n}\r\n\r\n/* VEHICLES */\r\nTiledManager.createVehicle = function(vehicleName, vehicleData = false) {\r\n    if(!vehicleData) {\r\n        vehicleData = Object.assign({}, _fullVehicleData, {\r\n            bgm: Object.assign({}, _fullVehicleData.bgm)\r\n        });\r\n    } else if(vehicleData !== true) {\r\n        vehicleData = Object.assign({}, _fullVehicleData, vehicleData, {\r\n            bgm: Object.assign({}, _fullVehicleData.bgm, vehicleData.bgm)\r\n        });\r\n    }\r\n    let vehicle = new Game_Vehicle(vehicleName, vehicleData);\r\n    _vehicles[vehicleName] = vehicle;\r\n    _vehiclesByIndex.push(vehicleName);\r\n};\r\n\r\nTiledManager.refreshVehicles = function(vehicles = []) {\r\n    _vehiclesByIndex.forEach(vehicleName => {\r\n        if(vehicles.length === 0 || vehicles.indexOf(vehicleName) > -1) {\r\n            _vehicles[vehicleName].refresh();\r\n        }\r\n    });\r\n};\r\n\r\nTiledManager.getAllVehicles = function(vehicles = []) {\r\n    let returnVehicles = [];\r\n    _vehiclesByIndex.forEach(vehicleName => {\r\n        if(vehicles.length === 0 || vehicles.indexOf(vehicleName) > -1) {\r\n            returnVehicles.push(_vehicles[vehicleName]);\r\n        }\r\n    });\r\n    return returnVehicles;\r\n};\r\n\r\nTiledManager.getVehicle = function(id) {\r\n    if(isNaN(id)) {\r\n        if(_vehicles[id]) {\r\n            return _vehicles[id];\r\n        }\r\n    } else {\r\n        if(id < _vehiclesByIndex.length) {\r\n            return _vehicles[_vehiclesByIndex[id]];\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nTiledManager.updateVehicles = function(vehicles = []) {\r\n    _vehiclesByIndex.forEach(vehicleName => {\r\n        if(vehicles.length === 0 || vehicles.indexOf(vehicleName) > -1) {\r\n            _vehicles[vehicleName].update();\r\n        }\r\n    });\r\n}\r\n\r\nTiledManager.getParameterVehicles = function() {\r\n    if(!!pluginParams['Custom Vehicles']) {\r\n        let vehicles = JSON.parse(pluginParams['Custom Vehicles']);\r\n        vehicles.forEach(vehicle => {\r\n            let vehicleData = JSON.parse(vehicle);\r\n            TiledManager.createVehicle(vehicleData.vehicleName, vehicleData);\r\n        })\r\n    }\r\n}\r\n\r\nTiledManager.setAutoFunction = function(identifier, functions = {}) {\r\n    _autoFunctions[identifier] = functions;\r\n}\r\n\r\nTiledManager.getAutoFunction = function(identifier) {\r\n    return _autoFunctions[identifier] || false;\r\n}\r\n\r\n/* PLUGIN COMMANDS */\r\n\r\nTiledManager.addPluginCommand = function(command, func) {\r\n    _pluginCommands[command] = func;\r\n}\r\n\r\nTiledManager.pluginCommand = function(command, args) {\r\n    if(_pluginCommands.hasOwnProperty(command)) {\r\n        _pluginCommands[command].call(this, args);\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/TiledManager.js","//-----------------------------------------------------------------------------\r\n// Sprite_TiledPriorityTile\r\n//\r\n// The sprite for displaying a priority tile.\r\n\r\nfunction Sprite_TiledPriorityTile() {\r\n    this.initialize.apply(this, arguments);\r\n}\r\n\r\nSprite_TiledPriorityTile.prototype = Object.create(Sprite_Base.prototype);\r\nSprite_TiledPriorityTile.prototype.constructor = Sprite_TiledPriorityTile;\r\n\r\nwindow.Sprite_TiledPriorityTile = Sprite_TiledPriorityTile;\r\n\r\nSprite_TiledPriorityTile.prototype.updateVisibility = function() {\r\n    let visibility = false;\r\n    if(this.layerId > -1) {\r\n        visibility = true;\r\n        let props = $gameMap.getLayerProperties(this.layerId);\r\n        if(props.transition) {\r\n            visibility = props.minAlpha > 0 || props.transitionPhase > 0;\r\n            this.opacity = 255 * (((props.baseAlpha - props.minAlpha) * (props.transitionPhase / props.transition)) + props.minAlpha);\r\n        } else {\r\n            let layer = $gameMap.tiledData.layers[this.layerId];\r\n            visibility = !TiledManager.checkLayerHidden(layer);\r\n        }\r\n    }\r\n    this.visible = visibility;\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Sprite_TiledPriorityTile.js","/* A fallback implementation of AlphaFilter */\r\n\r\nconst fragmentSrc = 'varying vec2 vTextureCoord;' +\r\n'uniform sampler2D uSampler;' +\r\n'uniform float uAlpha;' +\r\n'void main(void)' +\r\n'{' +\r\n'   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;' +\r\n'}';\r\n\r\nif(!PIXI.filters.AlphaFilter) {\r\n    class AlphaFilter extends PIXI.Filter\r\n    {\r\n        /**\r\n         * @param {number} [alpha=1] Amount of alpha from 0 to 1, where 0 is transparent\r\n         */\r\n        constructor(alpha = 1.0)\r\n        {\r\n            super(\r\n                // vertex shader\r\n                null,\r\n                // fragment shader\r\n               fragmentSrc\r\n            );\r\n            this.alpha = alpha;\r\n            this.glShaderKey = 'alpha';\r\n        }\r\n        /**\r\n         * Coefficient for alpha multiplication\r\n         *\r\n         * @member {number}\r\n         * @default 1\r\n         */\r\n        get alpha()\r\n        {\r\n            return this.uniforms.uAlpha;\r\n        }\r\n        set alpha(value) // eslint-disable-line require-jsdoc\r\n        {\r\n            this.uniforms.uAlpha = value;\r\n        }\r\n    }\r\n    PIXI.filters.AlphaFilter = AlphaFilter;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/AlphaFilter.js","import TiledTileShader from \"./TiledTileShader\";\r\n\r\nexport default class TiledTileLayer extends PIXI.tilemap.CompositeRectTileLayer {\r\n    constructor(zIndex, bitmaps, useSquare, texPerChild) {\r\n        super(zIndex, bitmaps, useSquare, texPerChild)\r\n    }\r\n\r\n    renderWebGL(renderer) {\r\n        var gl = renderer.gl;\r\n        if(!this.tiledTileShader) {\r\n            this.tiledTileShader = new TiledTileShader(gl, renderer.plugins.tilemap.maxTextures, this.useSquare)\r\n        }\r\n        var alpha = this.alpha;\r\n        var props = $gameMap.getLayerProperties(this.layerId);\r\n        if(props.transition) {\r\n            alpha-= props.minAlpha\r\n            alpha*= (props.transitionPhase / props.transition)\r\n            alpha+= props.minAlpha\r\n        }\r\n        //var shader = renderer.plugins.tilemap.getShader(this.useSquare);\r\n        var shader = this.tiledTileShader;\r\n        renderer.setObjectRenderer(renderer.plugins.tilemap);\r\n        renderer.bindShader(shader);\r\n        this._globalMat = this._globalMat || new PIXI.Matrix();\r\n        renderer._activeRenderTarget.projectionMatrix.copy(this._globalMat).append(this.worldTransform);\r\n        shader.uniforms.projectionMatrix = this._globalMat.toArray(true);\r\n        shader.uniforms.shadowColor = this.shadowColor;\r\n        shader.uniforms.alpha = alpha;\r\n        if (this.useSquare) {\r\n            var tempScale = this._tempScale = (this._tempScale || [0, 0]);\r\n            tempScale[0] = this._globalMat.a >= 0 ? 1 : -1;\r\n            tempScale[1] = this._globalMat.d < 0 ? 1 : -1;\r\n            var ps = shader.uniforms.pointScale = tempScale;\r\n            shader.uniforms.projectionScale = Math.abs(this.worldTransform.a) * renderer.resolution;\r\n        }\r\n        var af = shader.uniforms.animationFrame = renderer.plugins.tilemap.tileAnim;\r\n        var layers = this.children;\r\n        for (var i = 0; i < layers.length; i++) {\r\n            layers[i].renderWebGL(renderer, this.useSquare);\r\n        }\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/TiledTileLayer.js","const GLBuffer = PIXI.glCore.GLBuffer;\r\nconst VertexArrayObject = PIXI.glCore.VertexArrayObject;\r\n\r\nvar squareShaderFrag = `\r\nvarying vec2 vTextureCoord;\r\nvarying float vSize;\r\nvarying float vTextureId;\r\n\r\nuniform vec4 shadowColor;\r\nuniform sampler2D uSamplers[%count%];\r\nuniform vec2 uSamplerSize[%count%];\r\nuniform vec2 pointScale;\r\nuniform float alpha;\r\n\r\nvoid main(void){\r\n   float margin = 0.5 / vSize;\r\n   vec2 pointCoord = (gl_PointCoord - 0.5) * pointScale + 0.5;\r\n   vec2 clamped = vec2(clamp(pointCoord.x, margin, 1.0 - margin), clamp(pointCoord.y, margin, 1.0 - margin));\r\n   vec2 textureCoord = pointCoord * vSize + vTextureCoord;\r\n   float textureId = vTextureId;\r\n   vec4 color;\r\n   %forloop%\r\n   gl_FragColor = color * alpha;\r\n}\r\n`\r\n\r\nvar squareShaderVert = `\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\nattribute vec2 aAnim;\r\nattribute float aTextureId;\r\nattribute float aSize;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform vec2 samplerSize;\r\nuniform vec2 animationFrame;\r\nuniform float projectionScale;\r\n\r\nvarying vec2 vTextureCoord;\r\nvarying float vSize;\r\nvarying float vTextureId;\r\n\r\nvoid main(void){\r\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition + aSize * 0.5, 1.0)).xy, 0.0, 1.0);\r\n   gl_PointSize = aSize * projectionScale;\r\n   vTextureCoord = aTextureCoord + aAnim * animationFrame;\r\n   vTextureId = aTextureId;\r\n   vSize = aSize;\r\n}\r\n`\r\nvar rectShaderFrag = `\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 vFrame;\r\nvarying float vTextureId;\r\nuniform vec4 shadowColor;\r\nuniform sampler2D uSamplers[%count%];\r\nuniform vec2 uSamplerSize[%count%];\r\nuniform float alpha;\r\nvoid main(void){\r\n   vec2 textureCoord = clamp(vTextureCoord, vFrame.xy, vFrame.zw);\r\n   float textureId = floor(vTextureId + 0.5);\r\n   vec4 color;\r\n   %forloop%\r\n   gl_FragColor = color * alpha;\r\n}\r\n`;\r\n\r\nvar rectShaderVert = `\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\nattribute vec4 aFrame;\r\nattribute vec2 aAnim;\r\nattribute float aTextureId;\r\nuniform mat3 projectionMatrix;\r\nuniform vec2 animationFrame;\r\nvarying vec2 vTextureCoord;\r\nvarying float vTextureId;\r\nvarying vec4 vFrame;\r\nvoid main(void){\r\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n   vec2 anim = aAnim * animationFrame;\r\n   vTextureCoord = aTextureCoord + anim;\r\n   vFrame = aFrame + vec4(anim, anim);\r\n   vTextureId = aTextureId;\r\n}\r\n`;\r\nexport default class TiledTileShader extends PIXI.tilemap.TilemapShader {\r\n\r\n    constructor(gl, maxTextures, useSquare) {\r\n        let vert = useSquare ? squareShaderVert : rectShaderVert;\r\n        let frag = useSquare ? squareShaderFrag : rectShaderFrag;\r\n        super(gl,\r\n            maxTextures,\r\n            vert,\r\n            PIXI.tilemap.shaderGenerator.generateFragmentSrc(maxTextures, frag)\r\n        );\r\n        if(useSquare) {\r\n            this.vertSize = 8;\r\n            this.vertPerQuad = 1;\r\n            this.anim = 5;\r\n            this.textureId = 7;\r\n        } else {\r\n            this.vertSize = 11;\r\n            this.vertPerQuad = 4;\r\n            this.anim = 8;\r\n            this.textureId = 10;\r\n        }\r\n        this.maxTextures = maxTextures;\r\n        this.stride = this.vertSize * 4;\r\n        PIXI.tilemap.shaderGenerator.fillSamplers(this, this.maxTextures);\r\n    }\r\n\r\n    createVao(renderer, vb) {\r\n        var gl = renderer.gl;\r\n        return renderer.createVao()\r\n            .addIndex(this.indexBuffer)\r\n            .addAttribute(vb, this.attributes.aVertexPosition, gl.FLOAT, false, this.stride, 0)\r\n            .addAttribute(vb, this.attributes.aTextureCoord, gl.FLOAT, false, this.stride, 2 * 4)\r\n            .addAttribute(vb, this.attributes.aFrame, gl.FLOAT, false, this.stride, 4 * 4)\r\n            .addAttribute(vb, this.attributes.aAnim, gl.FLOAT, false, this.stride, this.anim * 4)\r\n            .addAttribute(vb, this.attributes.aTextureId, gl.FLOAT, false, this.stride, this.textureId * 4);\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/TiledTileShader.js","// Constants\r\nlet pluginParams = PluginManager.parameters(\"YED_Tiled\");\r\n\r\nObject.defineProperty(Game_Map.prototype, 'tiledData', {\r\n    get: function () {\r\n        return DataManager._tempTiledData;\r\n    },\r\n    configurable: true\r\n});\r\n\r\nObject.defineProperty(Game_Map.prototype, 'currentMapLevel', {\r\n    get: function () {\r\n        let varID = parseInt(pluginParams[\"Map Level Variable\"]);\r\n        if (!varID) {\r\n            return this._currentMapLevel;\r\n        } else {\r\n            return $gameVariables.value(varID);\r\n        }\r\n    },\r\n    set: function (value) {\r\n        let varID = parseInt(pluginParams[\"Map Level Variable\"]);\r\n        if (!varID) {\r\n            this._currentMapLevel = value;\r\n        } else {\r\n            $gameVariables.setValue(varID, value);\r\n        }\r\n    },\r\n    configurable: true\r\n});\r\n\r\nlet _setup = Game_Map.prototype.setup;\r\nGame_Map.prototype.setup = function (mapId) {\r\n    this._tiledInitialized = false;\r\n    this._levels = [];\r\n    this._collisionMap = {};\r\n    this._arrowCollisionMap = {};\r\n    this._regions = {};\r\n    this._mapLevelChange = {};\r\n    this._positionHeightChange = {};\r\n    this._tileFlags = {};\r\n    this._collisionMapLayers = [];\r\n    this._arrowCollisionMapLayers = [];\r\n    this._regionsLayers = [];\r\n    this._mapLevelChangeLayers = [];\r\n    this._positionHeightChangeLayers = [];\r\n    this._tileFlagsLayers = [];\r\n    this._currentMapLevel = 0;\r\n    this.currentMapLevel = 0;\r\n    this._waypoints = {};\r\n    this._layerProperties = [];\r\n    this._autoSize = false;\r\n    this._autoSizeBorder = 0;\r\n    this._offsets = { x: 0, y: 0 };\r\n    this._camera = {\r\n        focus: \"player\",\r\n        data: null\r\n    }\r\n    _setup.call(this, mapId);\r\n    if (this.isTiledMap()) {\r\n        $dataMap.width = this.tiledData.width;\r\n        $dataMap.height = this.tiledData.height;\r\n        this._setupTiled();\r\n        this._tiledInitialized = true;\r\n        if(this._refreshList) {\r\n            this._refreshList.forEach(character => {\r\n                character.refreshBushDepth();\r\n            })\r\n        }\r\n    } else {\r\n\t\tthis._tiledInitialized = true;\r\n\t}\r\n};\r\n\r\nGame_Map.prototype.isTiledInitialized = function() {\r\n    return !!this._tiledInitialized;\r\n}\r\n\r\nGame_Map.prototype.setRefreshDepth = function(character) {\r\n    if(!this._refreshList) {\r\n        this._refreshList = [];\r\n    }\r\n    this._refreshList.push(character);\r\n}\r\n\r\nGame_Map.prototype.isTiledMap = function () {\r\n    return !!this.tiledData;\r\n};\r\n\r\nGame_Map.prototype._setupTiled = function () {\r\n    this._initializeMapProperties();\r\n    this._initializeInfiniteMap();\r\n    this._setLayerProperties();\r\n    this._initializeMapLevel(0);\r\n\r\n    this._setupCollision();\r\n    this._setupRegion();\r\n    this._setupMapLevelChange();\r\n    this._setupTileFlags();\r\n    this._setupTiledEvents();\r\n};\r\n\r\nGame_Map.prototype._initializeMapProperties = function() {\r\n    let autoSize = false;\r\n    let border = 0;\r\n    if(this.tiledData.properties) {\r\n        if(this.tiledData.properties.hasOwnProperty('autoSize')) {\r\n            autoSize = this.tiledData.properties.autoSize;\r\n        }\r\n        if(this.tiledData.properties.hasOwnProperty('border')) {\r\n            border = this.tiledData.properties.border;\r\n        }\r\n    }\r\n    this._autoSize = autoSize;\r\n    this._autoSizeBorder = border;\r\n}\r\n\r\nGame_Map.prototype.offsets = function(x = false, y = false) {\r\n\tif(typeof x === 'object') {\r\n\t\tlet offsets = {\r\n\t\t\tx: (x.x || 0) - this._offsets.x,\r\n\t\t\ty: (x.y || 0) - this._offsets.y\r\n\t\t}\r\n\t\tif(typeof y === 'string' && offsets.hasOwnProperty(y)) {\r\n\t\t\treturn offsets[y];\r\n\t\t}\r\n\t\treturn offsets;\r\n\t}\r\n\tif(x !== false || y !== false) {\r\n\t\treturn {\r\n\t\t\tx: (x || 0) - this._offsets.x,\r\n\t\t\ty: (y || 0) - this._offsets.y\r\n\t\t}\r\n\t}\r\n    return {\r\n        x: this._offsets.x,\r\n        y: this._offsets.y\r\n    }\r\n}\r\n\r\nGame_Map.prototype._initializeInfiniteMap = function() {\r\n    if(!this.tiledData.infinite) {\r\n        return;\r\n    }\r\n    if(this._autoSize && this._autoSize !== 'false') {\r\n        this._setMapSize();\r\n    }\r\n\t/*\r\n\tThis used to convert chunk data into regular map data. I removed it because I realized that really big maps\r\n\twill pose a huge memory problem, especially if you have a lot of layers. It also won't affect the load time,\r\n\tas all other data will already be pre-processed.\r\n\t*/\r\n\t/*\r\n\tfor (let idx = 0; idx < this.tiledData.layers.length; idx++) {\r\n\t\tlet layerData = this.tiledData.layers[idx];\r\n\t\tif(!layerData.data && !!layerData.chunks) {\r\n\t\t\tlayerData.data = new Array(this.width() * this.height());\r\n\t\t\tlayerData.data.fill(0);\r\n\t\t\tlayerData.chunks.forEach(chunk => {\r\n\t\t\t\tfor(let i = 0; i < chunk.data.length; i++) {\r\n\t\t\t\t\tlet x = chunk.x - this._offsets.x + (i % chunk.width);\r\n\t\t\t\t\tlet y = chunk.y - this._offsets.y + Math.floor(i / chunk.width);\r\n\t\t\t\t\tif(x < 0 || y < 0 || x >= layerData.x + this.width() || y >= layerData.x + this.width()) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet realX = x + y * this.width();\r\n\t\t\t\t\tlayerData.data[realX] = chunk.data[i];\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\t*/\r\n}\r\n\r\n/**\r\n * Resizes an infinite map so that the entire map is visible.\r\n * The only thing this does is set the offset and the size of the map,\r\n * without changing the map data itself.\r\n */\r\nGame_Map.prototype._setMapSize = function() {\r\n\t// Initialize variables\r\n    var minX = false;\r\n    var minY = false;\r\n    var maxX = false;\r\n    var maxY = false;\r\n    for (let idx = 0; idx < this.tiledData.layers.length; idx++) {\r\n        var layer = this.tiledData.layers[idx];\r\n        if(layer.type !== 'tilelayer') {\r\n            continue;\r\n        }\r\n        var x1 = layer.startx;\r\n        var y1 = layer.starty;\r\n        var x2 = x1 + layer.width;\r\n        var y2 = y1 + layer.height;\r\n\t\tif(this._autoSize === 'deep' || this._autoSize === 'crop') {\r\n\t\t\tif(minX === false || x1 < minX) {\r\n\t\t\t\tx1 = this._cropInfiniteMap(layer, x1, (minX === false ? x2 : minX));\r\n\t\t\t}\r\n\t\t\tif(minY === false || y1 < minY) {\r\n\t\t\t\ty1 = this._cropInfiniteMap(layer, y1, (minY === false ? y2 : minY), true, true);\r\n\t\t\t}\r\n\t\t\tif(maxX === false || x2 > maxX) {\r\n\t\t\t\tx2 = this._cropInfiniteMap(layer, x2, (maxX === false ? x1 : maxX), false);\r\n\t\t\t}\r\n\t\t\tif(maxY === false || y2 > maxY) {\r\n\t\t\t\ty2 = this._cropInfiniteMap(layer, y2, (maxY === false ? y1 : maxY), false, true);\r\n\t\t\t}\r\n\t\t}\r\n        minX = minX !== false ? Math.min(minX, x1) : x1;\r\n        minY = minY !== false ? Math.min(minY, y1) : y1;\r\n        maxX = maxX !== false ? Math.max(maxX, x2) : x2;\r\n        maxY = maxY !== false ? Math.max(maxY, y2) : y2;\r\n    }\r\n\tif(this._autoSizeBorder) {\r\n\t\tlet border = [0, 0, 0, 0];\r\n\t\tif(isNaN(this._autoSizeBorder)) {\r\n\t\t\tlet autoBorder = this.autoSizeBorder.split(' ');\r\n\t\t\tborder[0] = parseInt(autoBorder[0]);\r\n\t\t\tborder[1] = autoBorder.length < 2 ? border[0] : parseInt(autoBorder[1]);\r\n\t\t\tborder[2] = autoBorder.length < 3 ? border[0] : parseInt(autoBorder[2]);\r\n\t\t\tborder[3] = autoBorder.length < 4 ? border[1] : parseInt(autoBorder[3]);\r\n\t\t} else {\r\n\t\t\tborder[0] = this._autoSizeBorder;\r\n\t\t\tborder[1] = this._autoSizeBorder;\r\n\t\t\tborder[2] = this._autoSizeBorder;\r\n\t\t\tborder[3] = this._autoSizeBorder;\r\n\t\t}\r\n\t\tminX-= +border[3];\r\n\t\tminY-= +border[0];\r\n\t\tmaxX+= +border[1];\r\n\t\tmaxY+= +border[2];\r\n\t}\r\n    this._offsets.x = minX;\r\n    this._offsets.y = minY;\r\n    this.tiledData.width = maxX - minX;\r\n    this.tiledData.height = maxY - minY;\r\n}\r\n\r\nGame_Map.prototype._cropInfiniteMap = function(layer, offset, limit, forward = true, vertical = false) {\r\n\tlet o = offset;\r\n\tlet d = vertical ? 'y' : 'x';\r\n\tlet s = vertical ? 'height' : 'width';\r\n\twhile((forward && o < limit) || (!forward && o > limit)) {\r\n\t\tlet realO = o - (!forward ? 1 : 0);\r\n\t\tlet lineEmpty = true;\r\n\t\tfor(let chunkIdx = 0; chunkIdx < layer.chunks.length; chunkIdx++) {\r\n\t\t\tlet chunk = layer.chunks[chunkIdx];\r\n\t\t\tif(realO < chunk[d] || realO >= chunk[d] + chunk[s]) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlet empty = true;\r\n\t\t\tfor(let o2 = 0; o2 < chunk[s]; o2++) {\r\n\t\t\t\tlet coords = {\r\n\t\t\t\t\t[d]: realO - chunk[d],\r\n\t\t\t\t\t[vertical ? 'x' : 'y']: o2\r\n\t\t\t\t};\r\n\t\t\t\tlet i = coords.x + coords.y * chunk.width;\r\n\t\t\t\tif(chunk.data[i]) {\r\n\t\t\t\t\tempty = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!empty) {\r\n\t\t\t\tlineEmpty = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!lineEmpty) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\to+= forward ? 1 : -1;\r\n\t}\r\n\treturn o;\r\n}\r\n\r\nGame_Map.prototype._setLayerProperties = function() {\r\n    let autoFunctions = {};\r\n    for (let idx = 0; idx < this.tiledData.layers.length; idx++) {\r\n        let layer = this.tiledData.layers[idx];\r\n        let layerProperties = Object.assign({}, layer.properties, {layerId: idx});\r\n        if(layerProperties.transition) {\r\n            layerProperties.baseAlpha = layer.opacity;\r\n            layerProperties.minAlpha = Math.min(layerProperties.baseAlpha, (layer.properties.minimumOpacity || 0));\r\n            layerProperties.isShown = !TiledManager.checkLayerHidden(layer);\r\n            layerProperties.transitionPhase = layerProperties.isShown ? layerProperties.transition : 0;\r\n        }\r\n        if(layerProperties.autoX) {\r\n            layerProperties.autoSpeedX = layerProperties.autoX;\r\n            layerProperties.autoX = 0;\r\n            layerProperties.imageWidth = layerProperties.imageWidth || 0;\r\n            let funcX = 'linear';\r\n            if(layerProperties.autoFunctionX) {\r\n                funcX = layerProperties.autoFunctionX;\r\n            } else if (layerProperties.autoFunction) {\r\n                funcX = layerProperties.autoFunction;\r\n            }\r\n            let tFuncX = TiledManager.getAutoFunction(funcX);\r\n            if(tFuncX) {\r\n                layerProperties.autoXFunction = tFuncX.x || tFuncX.both;\r\n            } else {\r\n                if(!autoFunctions[funcX]) {\r\n                    autoFunctions[funcX] = new Function('x', 'y', funcX);\r\n                }\r\n                layerProperties.autoXFunction = autoFunctions[funcX];\r\n            }\r\n        }\r\n        if(layerProperties.autoY) {\r\n            layerProperties.autoSpeedY = layerProperties.autoY;\r\n            layerProperties.autoY = 0;\r\n            layerProperties.imageHeight = layerProperties.imageHeight || 0;\r\n            let funcY = 'linear';\r\n            if(layerProperties.autoFunctionY) {\r\n                funcY = layerProperties.autoFunctionY;\r\n            } else if (layerProperties.autoFunction) {\r\n                funcY = layerProperties.autoFunction;\r\n            }\r\n            let tFuncY = TiledManager.getAutoFunction(funcY);\r\n            if(tFuncY) {\r\n                layerProperties.autoYFunction = tFuncY.y || tFuncY.both;\r\n            } else {\r\n                if(!autoFunctions[funcY]) {\r\n                    autoFunctions[funcY] = new Function('x', 'y', funcY);\r\n                }\r\n                layerProperties.autoYFunction = autoFunctions[funcY];\r\n            }\r\n        }\r\n        this._layerProperties.push(layerProperties);\r\n    }\r\n}\r\n\r\nGame_Map.prototype._initializeMapLevel = function (id) {\r\n    if (!!this._collisionMap[id]) {\r\n        return;\r\n    }\r\n\r\n    this._levels.push(id);\r\n\r\n    this._collisionMap[id] = {};\r\n    this._arrowCollisionMap[id] = {};\r\n    this._regions[id] = {};\r\n    this._mapLevelChange[id] = {};\r\n    this._tileFlags[id] = {};\r\n    this._collisionMapLayers[id] = [];\r\n    this._arrowCollisionMapLayers[id] = [];\r\n    this._regionsLayers[id] = [];\r\n    this._mapLevelChangeLayers[id] = [];\r\n    this._tileFlagsLayers[id] = [];\r\n    this._initializeMapLevelData(id);\r\n};\r\n\r\nGame_Map.prototype._initializeMapLevelData = function(id = 0, layerId = 'main', dataTypes = false) {\r\n    let width = this.width();\r\n    let height = this.height();\r\n    let size = width * height;\r\n    \r\n    const defaultData = {\r\n        'collisionMap': 0,\r\n        'arrowCollisionMap': 1 | 2 | 4 | 8,\r\n        'regions': 0,\r\n        'mapLevelChange': -1,\r\n        'positionHeightChange': -1,\r\n        'tileFlags': 0\r\n    }\r\n\r\n    if(!dataTypes) {\r\n        dataTypes = Object.keys(defaultData);\r\n    }\r\n\r\n    for(let idx = 0; idx < dataTypes.length; idx++) {\r\n        let dataType = dataTypes[idx];\r\n        let defaultValue = defaultData[dataType];\r\n        if(!this['_' + dataType][id]) {\r\n            this['_' + dataType][id] = {};\r\n            this['_' + dataType + 'Layers'][id] = [];\r\n        }\r\n        if(!!this['_' + dataType][id][layerId]) {\r\n            continue;\r\n        }\r\n        this['_' + dataType][id][layerId] = []\r\n        let typeData = this['_' + dataType][id][layerId]\r\n        for (let x of Array(size).keys()) {\r\n            typeData.push(defaultValue);\r\n        }\r\n    }\r\n}\r\n\r\nGame_Map.prototype._setupCollision = function () {\r\n    this._setupCollisionFull();\r\n    this._setupCollisionArrow();\r\n};\r\n\r\nGame_Map.prototype._setupCollisionFull = function () {\r\n    let width = this.width();\r\n    let height = this.height();\r\n    let size = width * height;\r\n    let halfWidth = width / 2;\r\n    let halfHeight = height / 2;\r\n\r\n    if (this.isHalfTile()) {\r\n        size /= 4;\r\n    }\r\n\r\n    for (let idx = 0; idx < this.tiledData.layers.length; idx++) {\r\n        let layerData = this.tiledData.layers[idx]\r\n        if (!layerData.properties || !layerData.properties.collision) {\r\n            continue;\r\n        }\r\n\r\n        if (layerData.properties.collision !== \"full\"\r\n            && layerData.properties.collision !== \"up-left\"\r\n            && layerData.properties.collision !== \"up-right\"\r\n            && layerData.properties.collision !== \"down-left\"\r\n            && layerData.properties.collision !== \"down-right\"\r\n            && layerData.properties.collision !== \"tiles\") {\r\n            continue;\r\n        }\r\n\r\n        let level = parseInt(layerData.properties.level) || 0;\r\n        this._initializeMapLevel(level);\r\n        \r\n        let layerId = 'main';\r\n\r\n        if(TiledManager.hasHideProperties(layerData)) {\r\n            layerId = idx;\r\n            this._collisionMapLayers[level].push(idx);\r\n            this._initializeMapLevelData(level, layerId, ['collisionMap']);\r\n        }\r\n        \r\n        for (let x of Array(size).keys()) {\r\n            let realX = x;\r\n            let ids = [];\r\n            if (this.isHalfTile()) {\r\n                realX = Math.floor(x / halfWidth) * width * 2 + (x % halfWidth) * 2;\r\n            }\r\n            if (!!TiledManager.extractTileId(layerData, x)) {\r\n                switch(layerData.properties.collision) {\r\n                    case \"full\":\r\n                        ids.push(realX);\r\n                        if (this.isHalfTile()) {\r\n                            ids.push(realX + 1, realX + width, realX + width + 1);\r\n                        }\r\n                        break;\r\n                    case \"up-left\":\r\n                        ids.push(realX);\r\n                        break;\r\n                    case \"up-right\":\r\n                        ids.push(realX + 1);\r\n                        break;\r\n                    case \"down-left\":\r\n                        ids.push(realX + width);\r\n                        break;\r\n                    case \"down-right\":\r\n                        ids.push(realX + width + 1);\r\n                        break;\r\n                    case \"tiles\":\r\n                        let tileId = TiledManager.extractTileId(layerData, x);\r\n                        let tileset = this._getTileset(tileId);\r\n                        if(tileset && tileset.tileproperties) {\r\n                            let tileData = tileset.tileproperties[tileId - tileset.firstgid];\r\n                            if(tileData) {\r\n                                if(tileData.collision) {\r\n                                    ids.push(realX);\r\n                                    if (this.isHalfTile()) {\r\n                                        ids.push(realX + 1, realX + width, realX + width + 1);\r\n                                    }\r\n                                }\r\n                                if(tileData.collisionUpLeft) {\r\n                                    ids.push(realX);\r\n                                }\r\n                                if(tileData.collisionUpRight) {\r\n                                    ids.push(realX + 1);\r\n                                }\r\n                                if(tileData.collisionDownLeft) {\r\n                                    ids.push(realX + width);\r\n                                }\r\n                                if(tileData.collisionDownRight) {\r\n                                    ids.push(realX + width + 1);\r\n                                }\r\n                            }\r\n                        }\r\n                        break;\r\n                }\r\n                for (let id of ids) {\r\n                    this._collisionMap[level][layerId][id] = 1;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nGame_Map.prototype._setupCollisionArrow = function () {\r\n    let width = this.width();\r\n    let height = this.height();\r\n    let size = width * height;\r\n    let bit = 0;\r\n    let halfWidth = width / 2;\r\n    let halfHeight = height / 2;\r\n\r\n    if (this.isHalfTile()) {\r\n        size /= 4;\r\n    }\r\n\r\n    for (let idx = 0; idx < this.tiledData.layers.length; idx++) {\r\n        let layerData = this.tiledData.layers[idx]\r\n        if (!layerData.properties || !layerData.properties.collision) {\r\n            continue;\r\n        }\r\n\r\n        if (layerData.properties.collision !== \"arrow\" && layerData.properties.collision !== \"tiles\") {\r\n            continue;\r\n        }\r\n\r\n        if (!layerData.properties.arrowImpassable && layerData.properties.collision !== \"tiles\") {\r\n            continue;\r\n        }\r\n        \r\n        if(layerData.properties.arrowImpassable) {\r\n\r\n            if (layerData.properties.arrowImpassable === \"down\") {\r\n                bit = 1;\r\n            }\r\n\r\n            if (layerData.properties.arrowImpassable === \"left\") {\r\n                bit = 2;\r\n            }\r\n\r\n            if (layerData.properties.arrowImpassable === \"right\") {\r\n                bit = 4;\r\n            }\r\n\r\n            if (layerData.properties.arrowImpassable === \"up\") {\r\n                bit = 8;\r\n            }\r\n\r\n\r\n        }\r\n\r\n        let level = parseInt(layerData.properties.level) || 0;\r\n        this._initializeMapLevel(level);\r\n        \r\n        let layerId = 'main';\r\n\r\n        if(TiledManager.hasHideProperties(layerData)) {\r\n            layerId = idx;\r\n            this._arrowCollisionMapLayers[level].push(idx);\r\n            this._initializeMapLevelData(level, layerId, ['arrowCollisionMap']);\r\n        }\r\n        \r\n        let arrowCollisionMap = this._arrowCollisionMap[level][layerId];\r\n        for (let x of Array(size).keys()) {\r\n            let realX = x;\r\n            if (this.isHalfTile()) {\r\n                realX = Math.floor(x / halfWidth) * width * 2 + (x % halfWidth) * 2;\r\n            }\r\n\r\n            if (!!TiledManager.extractTileId(layerData, x)) {\r\n                let realBit = bit;\r\n                if(layerData.properties.collision === \"tiles\") {\r\n                    realBit = 0;\r\n                    let tileId = TiledManager.extractTileId(layerData, x);\r\n                    let tileset = this._getTileset(tileId);\r\n                    if(tileset && tileset.tileproperties) {\r\n                        let tileData = tileset.tileproperties[tileId - tileset.firstgid];\r\n                        if(tileData) {\r\n                            if(tileData.arrowImpassableDown) {\r\n                                realBit+= 1;\r\n                            }\r\n                            if(tileData.arrowImpassableLeft) {\r\n                                realBit+= 2;\r\n                            }\r\n                            if(tileData.arrowImpassableRight) {\r\n                                realBit+= 4;\r\n                            }\r\n                            if(tileData.arrowImpassableUp) {\r\n                                realBit+= 8;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                arrowCollisionMap[realX] = arrowCollisionMap[realX] ^ realBit;\r\n                if (this.isHalfTile()) {\r\n                    arrowCollisionMap[realX + 1]\r\n                        = arrowCollisionMap[realX + 1] ^ realBit;\r\n                    arrowCollisionMap[realX + width]\r\n                        = arrowCollisionMap[realX + width] ^ realBit;\r\n                    arrowCollisionMap[realX + width + 1]\r\n                        = arrowCollisionMap[realX + width + 1] ^ realBit;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nGame_Map.prototype._setupRegion = function () {\r\n    let width = this.width();\r\n    let height = this.height();\r\n    let size = width * height;\r\n    let halfWidth = width / 2;\r\n    let halfHeight = height / 2;\r\n\r\n    if (this.isHalfTile()) {\r\n        size /= 4;\r\n    }\r\n\r\n    for (let idx = 0; idx < this.tiledData.layers.length; idx++) {\r\n        let layerData = this.tiledData.layers[idx]\r\n        if (!layerData.properties || !layerData.properties.regionId) {\r\n            continue;\r\n        }\r\n\r\n        let level = parseInt(layerData.properties.level) || 0;\r\n        this._initializeMapLevel(level);\r\n        \r\n        let layerId = 'main';\r\n\r\n        if(TiledManager.hasHideProperties(layerData)) {\r\n            layerId = idx;\r\n            this._regionsLayers[level].push(idx);\r\n            this._initializeMapLevelData(level, layerId, ['regions']);\r\n        }\r\n        \r\n        let regionMap = this._regions[level][layerId];\r\n\r\n        for (let x of Array(size).keys()) {\r\n            let realX = x;\r\n            if (this.isHalfTile()) {\r\n                realX = Math.floor(x / halfWidth) * width * 2 + (x % halfWidth) * 2;\r\n            }\r\n\r\n            if (!!TiledManager.extractTileId(layerData, x)) {\r\n                let regionId = 0;\r\n                if(layerData.properties.regionId > -1) {\r\n                    regionId = parseInt(layerData.properties.regionId);\r\n                } else {\r\n                    let tileId = TiledManager.extractTileId(layerData, x);\r\n                    let tileset = this._getTileset(tileId);\r\n                    if(tileset && tileset.tileproperties) {\r\n                        let tileData = tileset.tileproperties[tileId - tileset.firstgid];\r\n                        if(tileData && tileData.regionId) {\r\n                            regionId = parseInt(tileData.regionId);\r\n                        }\r\n                    }\r\n                    if(layerData.properties.regionOffset) {\r\n                        regionId+= layerData.properties.regionOffset;\r\n                    }\r\n                }\r\n                regionMap[realX] = regionId;\r\n                if (this.isHalfTile()) {\r\n                    regionMap[realX + 1] = regionId;\r\n                    regionMap[realX + width] = regionId;\r\n                    regionMap[realX + width + 1] = regionId;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nGame_Map.prototype._setupMapLevelChange = function () {\r\n    let width = this.width();\r\n    let height = this.height();\r\n    let size = width * height;\r\n    let halfWidth = width / 2;\r\n    let halfHeight = height / 2;\r\n\r\n    if (this.isHalfTile()) {\r\n        size /= 4;\r\n    }\r\n\r\n    for (let idx = 0; idx < this.tiledData.layers.length; idx++) {\r\n        let layerData = this.tiledData.layers[idx]\r\n        if (!layerData.properties || !layerData.properties.hasOwnProperty('toLevel')) {\r\n            continue;\r\n        }\r\n\r\n        let level = parseInt(layerData.properties.level) || 0;\r\n        this._initializeMapLevel(level);\r\n        let layerId = 'main';\r\n\r\n        if(TiledManager.hasHideProperties(layerData)) {\r\n            layerId = idx;\r\n            this._mapLevelChangeLayers[level].push(idx);\r\n            this._initializeMapLevelData(level, layerId, ['mapLevelChange']);\r\n        }\r\n        \r\n        let levelChangeMap = this._mapLevelChange[level][layerId];\r\n\r\n        for (let x of Array(size).keys()) {\r\n            let realX = x;\r\n            let toLevel = parseInt(layerData.properties.toLevel);\r\n            if (this.isHalfTile()) {\r\n                realX = Math.floor(x / halfWidth) * width * 2 + (x % halfWidth) * 2;\r\n            }\r\n\r\n            if (!!TiledManager.extractTileId(layerData, x)) {\r\n                levelChangeMap[realX] = toLevel;\r\n                if (this.isHalfTile()) {\r\n                    levelChangeMap[realX + 1] = toLevel;\r\n                    levelChangeMap[realX + width] = toLevel;\r\n                    levelChangeMap[realX + width + 1] = toLevel;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nGame_Map.prototype._setupPositionHeightChange = function () {\r\n    let width = this.width();\r\n    let height = this.height();\r\n    let size = width * height;\r\n    let halfWidth = width / 2;\r\n    let halfHeight = height / 2;\r\n\r\n    if (this.isHalfTile()) {\r\n        size /= 4;\r\n    }\r\n\r\n    for (let idx = 0; idx < this.tiledData.layers.length; idx++) {\r\n        let layerData = this.tiledData.layers[idx]\r\n        if (!layerData.properties || !layerData.properties.hasOwnProperty('floorHeight')) {\r\n            continue;\r\n        }\r\n\r\n        let level = parseInt(layerData.properties.level) || 0;\r\n        this._initializeMapLevel(level);\r\n        let layerId = 'main';\r\n\r\n        if(TiledManager.hasHideProperties(layerData)) {\r\n            layerId = idx;\r\n            this._positionHeightChangeLayers[level].push(idx);\r\n            this._initializeMapLevelData(level, layerId, ['positionHeightChange']);\r\n        }\r\n        \r\n        let positionHeightChangeMap = this._positionHeightChange[level][layerId];\r\n\r\n        for (let x of Array(size).keys()) {\r\n            let realX = x;\r\n            let toLevel = parseInt(layerData.properties.floorHeight);\r\n            if (this.isHalfTile()) {\r\n                realX = Math.floor(x / halfWidth) * width * 2 + (x % halfWidth) * 2;\r\n            }\r\n\r\n            if (!!TiledManager.extractTileId(layerData, x)) {\r\n                positionHeightChangeMap[realX] = toLevel;\r\n                if (this.isHalfTile()) {\r\n                    positionHeightChangeMap[realX + 1] = toLevel;\r\n                    positionHeightChangeMap[realX + width] = toLevel;\r\n                    positionHeightChangeMap[realX + width + 1] = toLevel;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nGame_Map.prototype._setupTileFlags = function() {\r\n    let width = this.width();\r\n    let height = this.height();\r\n    let size = width * height;\r\n    let halfWidth = width / 2;\r\n    let halfHeight = height / 2;\r\n\r\n    if (this.isHalfTile()) {\r\n        size /= 4;\r\n    }\r\n    \r\n    for (let idx = 0; idx < this.tiledData.layers.length; idx++) {\r\n        let layerData = this.tiledData.layers[idx]\r\n        if (!layerData.properties || !layerData.properties.tileFlags) {\r\n            continue;\r\n        }\r\n\r\n        let level = parseInt(layerData.properties.level) || 0;\r\n        this._initializeMapLevel(level);\r\n        \r\n        let layerId = 'main';\r\n\r\n        if(TiledManager.hasHideProperties(layerData)) {\r\n            layerId = idx;\r\n            this._tileFlagsLayers[level].push(idx);\r\n            this._initializeMapLevelData(level, layerId, ['tileFlags']);\r\n        }\r\n        \r\n        let tileFlagMap = this._tileFlags[level][layerId];\r\n\r\n        for (let x of Array(size).keys()) {\r\n            let realX = x;\r\n            if (this.isHalfTile()) {\r\n                realX = Math.floor(x / halfWidth) * width * 2 + (x % halfWidth) * 2;\r\n            }\r\n\r\n            if (!!TiledManager.extractTileId(layerData, x)) {\r\n                let tileFlags = 0;\r\n                let tileId = TiledManager.extractTileId(layerData, x);\r\n                let tileset = this._getTileset(tileId);\r\n                if(tileset && tileset.tileproperties) {\r\n                    let tileData = tileset.tileproperties[tileId - tileset.firstgid];\r\n                    if(tileData) {\r\n                        tileFlags = this._getTileFlags(tileData);\r\n                    }\r\n                }\r\n                tileFlagMap[realX] = this._combineFlags(tileFlagMap[realX], tileFlags);\r\n                if (this.isHalfTile()) {\r\n                    tileFlagMap[realX + 1] = this._combineFlags(tileFlagMap[realX + 1], tileFlags);\r\n                    tileFlagMap[realX + width] = this._combineFlags(tileFlagMap[realX + width], tileFlags);\r\n                    tileFlagMap[realX + width + 1] = this._combineFlags(tileFlagMap[realX + width + 1], tileFlags);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nGame_Map.prototype._getTileFlags = function(tileData) {\r\n    let flags = []\r\n    let flagNames = TiledManager.getFlagNames()\r\n    flagNames.forEach(prop => {\r\n        let property = 'flagIs' + prop.slice(0, 1).toUpperCase() + prop.slice(1)\r\n        if(tileData[property]) {\r\n            let [group, bit] = TiledManager.getFlagLocation(prop)\r\n            for(let i = flags.length; i <= group; i++) {\r\n                flags.push(0)\r\n            }\r\n            flags[group]|= bit\r\n        }\r\n    })\r\n    return flags.length > 0 ? flags : 0\r\n}\r\n\r\nGame_Map.prototype._combineFlags = function (source, target) {\r\n    source = source ? source.slice(0) : []\r\n    for(let i = 0; i < target.length; i++) {\r\n        if(!source.length <= i) {\r\n            source.push(i)\r\n        }\r\n        source[i]|= target[i];\r\n    }\r\n    return source;\r\n}\r\n\r\nGame_Map.prototype._setupTiledEvents = function () {\r\n    for (let layerData of this.tiledData.layers) {\r\n        if (layerData.type !== \"objectgroup\") {\r\n            continue;\r\n        }\r\n\r\n        for (let object of layerData.objects) {\r\n            if (!object.properties) {\r\n                continue;\r\n            }\r\n\r\n            if(object.properties.waypoint) {\r\n                let x = object.x / this.tileWidth();\r\n                let y = object.y / this.tileHeight();\r\n                if(pluginParams[\"Constrain Events to Grid\"].toLowerCase() === \"true\") {\r\n                    x = Math.floor(x);\r\n                    y = Math.floor(y);\r\n                }\r\n                this._waypoints[object.properties.waypoint] = {x, y}\r\n                continue;\r\n            }\r\n\r\n            if (!object.properties.eventId && !object.properties.vehicle) {\r\n                continue;\r\n            }\r\n\r\n            let event;\r\n\r\n            if(!!object.properties.vehicle) {\r\n                event = this.vehicle(object.properties.vehicle);\r\n                this._vehicles.push(object.properties.vehicle);\r\n            } else {\r\n                let eventId = parseInt(object.properties.eventId);\r\n                event = this._events[eventId];\r\n            }\r\n            if (!event) {\r\n                continue;\r\n            }\r\n            let x = object.x / this.tileWidth() - this._offsets.x;\r\n            let y = object.y / this.tileHeight() - this._offsets.y;\r\n            if(pluginParams[\"Constrain Events to Grid\"].toLowerCase() === \"true\") {\r\n                x = Math.floor(x);\r\n                y = Math.floor(y);\r\n            }\r\n            if (this.isHalfTile()) {\r\n                x += 1;\r\n                y += 1;\r\n            }\r\n            if(!!object.properties.vehicle) {\r\n                event.loadSystemSettings();\r\n                event.setLocation(this.mapId(), x, y);\r\n            } else {\r\n                event.locate(x, y);\r\n            }\r\n\t\t\tevent._tiledProperties = object.properties;\r\n        }\r\n    }\r\n};\r\n\r\nGame_Map.prototype.isHalfTile = function () {\r\n    return pluginParams[\"Half-tile movement\"].toLowerCase() === \"true\";\r\n};\r\n\r\nGame_Map.prototype._getTileset = function(tileId) {\r\n    for(let idx = 0; idx < this.tiledData.tilesets.length; idx++) {\r\n        let tileset = this.tiledData.tilesets[idx];\r\n        if(tileId >= tileset.firstgid && tileId < tileset.firstgid + tileset.tilecount) {\r\n            return tileset;\r\n        }\r\n    }\r\n    return null;\r\n};\r\n\r\nGame_Map.prototype.tileWidth = function () {\r\n    let tileWidth = this.tiledData.tilewidth;\r\n    if (this.isHalfTile()) {\r\n        tileWidth /= 2;\r\n    }\r\n    return tileWidth;\r\n};\r\n\r\nGame_Map.prototype.tileHeight = function () {\r\n    let tileHeight = this.tiledData.tileheight;\r\n    if (this.isHalfTile()) {\r\n        tileHeight /= 2;\r\n    }\r\n    return tileHeight;\r\n};\r\n\r\nGame_Map.prototype.width = function () {\r\n    let width = this.tiledData.width;\r\n    if (this.isHalfTile()) {\r\n        width *= 2;\r\n    }\r\n    return width;\r\n};\r\n\r\nGame_Map.prototype.height = function () {\r\n    let height = this.tiledData.height;\r\n    if (this.isHalfTile()) {\r\n        height *= 2;\r\n    }\r\n    return height;\r\n};\r\n\r\nlet _regionId = Game_Map.prototype.regionId;\r\nGame_Map.prototype.regionId = function (x, y, allIds = false) {\r\n    if (!this.isTiledMap() || !this.isTiledInitialized()) {\r\n        return _regionId.call(this, x, y);\r\n    }\r\n\r\n    let index = Math.floor(x) + this.width() * Math.floor(y);\r\n    let regionMap = this._regions[this.currentMapLevel];\r\n    let regionLayer = this._regionsLayers[this.currentMapLevel];\r\n    \r\n    let regionValue = regionMap.main[index];\r\n    let regionValues = [regionValue];\r\n\r\n    if(regionLayer && regionLayer.length > 0) {\r\n        for(let idx = 0; idx < regionLayer.length; idx++) {\r\n            let layerId = regionLayer[idx];\r\n            let layerData = this.tiledData.layers[layerId];\r\n            let hideData = TiledManager.checkLayerHidden(layerData, 'regions');\r\n            if(!hideData) {\r\n                if(allIds) {\r\n                    regionValues.push(regionMap[layerId][index]);\r\n                } else {\r\n                    regionValue = regionMap[layerId][index];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return allIds ? regionValues : regionValue;\r\n};\r\n\r\nGame_Map.prototype.regionIds = function (x, y) {\r\n    return this.regionId(x, y, true);\r\n}\r\n\r\nGame_Map.prototype.getMapLevels = function() {\r\n    let levels = this._levels.slice(0);\r\n    levels.sort((a, b) => {\r\n        return a - b;\r\n    });\r\n    return levels;\r\n}\r\n\r\nlet _checkPassage = Game_Map.prototype.checkPassage;\r\nGame_Map.prototype.checkPassage = function (x, y, bit, render = false, level = false) {\r\n    if (!this.isTiledMap()) {\r\n        return _checkPassage.call(this, x, y, d);\r\n    }\r\n    if(level === false) {\r\n        level = this._currentMapLevel;\r\n    }\r\n    let index = x + this.width() * y;\r\n    let arrows = this._arrowCollisionMap[level];\r\n    let arrowLayer = this._arrowCollisionMapLayers[level];\r\n    let arrowValue = arrows.main[index];\r\n    \r\n    if(render && arrows[render]) {\r\n        arrowValue = arrows[render][index];\r\n    } else if(arrowLayer && arrowLayer.length > 0) {\r\n        for(let idx = 0; idx < arrowLayer.length; idx++) {\r\n            let layerId = arrowLayer[idx];\r\n            let layerData = this.tiledData.layers[layerId];\r\n            let hideData = TiledManager.checkLayerHidden(layerData, 'collisions');\r\n            if(!hideData) {\r\n                arrowValue&= arrows[layerId][index];\r\n            }\r\n        }\r\n    }\r\n\r\n    return (arrowValue & bit) > 0\r\n}\r\n\r\nGame_Map.prototype.renderPassage = function (x, y, bit, render = 'main', level = 0) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    if(render && !this._arrowCollisionMap[level][render]) {\r\n        render = 'main';\r\n    }\r\n    return this.checkPassage(x, y, bit, render, level);\r\n}\r\n\r\nGame_Map.prototype.getPassageLayers = function(level) {\r\n    return this._arrowCollisionMapLayers[level].slice(0);\r\n}\r\n\r\nlet _isPassable = Game_Map.prototype.isPassable;\r\nGame_Map.prototype.isPassable = function (x, y, d, render = false, level = false) {\r\n    if (!this.isTiledMap()) {\r\n        return _isPassable.call(this, x, y, d);\r\n    }\r\n    if(level === false) {\r\n        level = this._currentMapLevel;\r\n    }\r\n\r\n    if(!this.checkPassage(x, y, (1 << (d / 2 - 1)) & 0x0f, render)) {\r\n        return false;\r\n    }\r\n    \r\n    let index = x + this.width() * y;\r\n    let collisionMap = this._collisionMap[level];\r\n    let collisionLayer = this._collisionMapLayers[level];\r\n    let collisionValue = collisionMap.main[index]\r\n    \r\n    if(render && collisionMap[render]) {\r\n        collisionValue = collisionMap[render][index];\r\n    } else if(collisionLayer && collisionLayer.length > 0) {\r\n        for(let idx = 0; idx < collisionLayer.length; idx++) {\r\n            let layerId = collisionLayer[idx];\r\n            let layerData = this.tiledData.layers[layerId];\r\n            let hideData = TiledManager.checkLayerHidden(layerData, 'collisions');\r\n            if(!hideData) {\r\n                collisionValue|= collisionMap[layerId][index];\r\n            }\r\n        }\r\n    }\r\n\r\n    return collisionValue === 0;\r\n};\r\n\r\nGame_Map.prototype.renderIsPassable = function (x, y, d, render = 'main', level = 0) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    if(render && !this._collisionMap[level][render]) {\r\n        render = 'main';\r\n    }\r\n    return this.isPassable(x, y, d, render, level);\r\n}\r\n\r\nGame_Map.prototype.getIsPassableLayers = function(level) {\r\n    return this._collisionMapLayers[level].slice(0);\r\n}\r\n\r\nGame_Map.prototype.checkMapLevelChanging = function (x, y) {\r\n    let mapLevelChange = this._mapLevelChange[this.currentMapLevel];\r\n    let mapLevelChangeLayer = this._mapLevelChangeLayers[this.currentMapLevel];\r\n    let index = y * this.width() + x;\r\n    let mapLevelChangeValue = mapLevelChange.main[index]\r\n    if(mapLevelChangeLayer.length > 0) {\r\n        for(let idx = 0; idx < mapLevelChangeLayer.length; idx++) {\r\n            let layerId = mapLevelChangeLayer[idx];\r\n            let layerData = this.tiledData.layers[layerId];\r\n            let hideData = TiledManager.checkLayerHidden(layerData, 'levelChanges');\r\n            if(!hideData) {\r\n                mapLevelChangeValue = mapLevelChange[layerId][index];\r\n            }\r\n        }\r\n    }\r\n    if (mapLevelChangeValue < 0) {\r\n        return false;\r\n    }\r\n    let oldValue = this.currentMapLevel;\r\n    this.currentMapLevel = mapLevelChangeValue;\r\n    TiledManager.triggerListener(this, 'levelchanged', {\r\n        oldLevel: oldValue,\r\n        newLevel: mapLevelChangeValue\r\n    })\r\n    return true;\r\n};\r\n\r\nGame_Map.prototype.checkPositionHeight = function (x, y) {\r\n    let positionHeightChange = this._positionHeightChange[this.currentMapLevel];\r\n    let positionHeightChangeLayer = this._positionHeightChangeLayers[this.currentMapLevel];\r\n    let index = y * this.width() + x;\r\n    let positionHeightChangeValue = positionHeightChange.main[index]\r\n    if(positionHeightChangeLayer.length > 0) {\r\n        for(let idx = 0; idx < positionHeightChangeLayer.length; idx++) {\r\n            let layerId = positionHeightChangeLayer[idx];\r\n            let layerData = this.tiledData.layers[layerId];\r\n            let hideData = TiledManager.checkLayerHidden(layerData, 'positionHeightChanges');\r\n            if(!hideData) {\r\n                positionHeightChangeValue = positionHeightChange[layerId][index];\r\n            }\r\n        }\r\n    }\r\n    return positionHeightChangeValue;\r\n};\r\n\r\nGame_Map.prototype.getTileFlags = function (x, y, render = false, level = false) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    let index = x + this.width() * y;\r\n    let tileFlags = this._tileFlags[level];\r\n    let tileFlagsLayer = this._tileFlagsLayers[level];\r\n    let tileFlagsValue = (tileFlags.main[index] ? tileFlags.main[index].slice(0) : []);\r\n\r\n    if(render && tileFlags[render]) {\r\n        tileFlagsValue = (tileFlags[render][index] ? tileFlags[render][index].slice(0) : []);\r\n    } else if(tileFlagsLayer && tileFlagsLayer.length > 0) {\r\n        for(let idx = 0; idx < tileFlagsLayer.length; idx++) {\r\n            let layerId = tileFlagsLayer[idx];\r\n            let layerData = this.tiledData.layers[layerId];\r\n            let hideData = TiledManager.checkLayerHidden(layerData, 'tileFlags');\r\n            if(!hideData && tileFlags[layerId][index]) {\r\n                tileFlagsValue = this._combineFlags(tileFlagsValue, tileFlags[layerId][index])\r\n            }\r\n        }\r\n    }\r\n    return tileFlagsValue\r\n}\r\n\r\nGame_Map.prototype.renderTileFlags = function (x, y, render = 'main', level = 0) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    if(render && !this._tileFlags[level][render]) {\r\n        render = 'main';\r\n    }\r\n    return this.getTileFlags(x, y, render, level);\r\n}\r\n\r\nGame_Map.prototype.getTileFlagLayers = function(level) {\r\n    return this._tileFlagsLayers[level].slice(0);\r\n}\r\n\r\nGame_Map.prototype.checkHasTileFlag = function (x, y, flag, render = false, level = false) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    if(typeof flag === 'string') {\r\n        flag = TiledManager.getFlag(flag)\r\n    }\r\n    let bit = (1 << (flag % 16)) & 0xffff;\r\n    let group = Math.floor(flag / 16);\r\n    let tileFlagsValue = this.getTileFlags(x, y, render, level);\r\n    \r\n    return (tileFlagsValue[group] & bit) > 0\r\n}\r\n\r\nGame_Map.prototype.renderHasTileFlag = function (x, y, flag, render = 'main', level = 0) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    if(render && !this._tileFlags[level][render]) {\r\n        render = 'main';\r\n    }\r\n    return this.checkHasTileFlag(x, y, flag, render, level);\r\n}\r\n\r\nlet _isBoatPassable = Game_Map.prototype.isBoatPassable\r\nGame_Map.prototype.isBoatPassable = function(x, y, render = false, level = false) {\r\n    if (!this.isTiledMap()) {\r\n        return _isBoatPassable.call(this, x, y);\r\n    }\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.checkHasTileFlag(x, y, 'boat', render, level);\r\n};\r\n\r\nGame_Map.prototype.renderIsBoatPassable = function(x, y, render = 'main', level = 0) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isBoatPassable(x, y, render, level);\r\n}\r\n\r\nlet _isShipPassable = Game_Map.prototype.isShipPassable\r\nGame_Map.prototype.isShipPassable = function(x, y, render = false, level = false) {\r\n    if (!this.isTiledMap()) {\r\n        return _isShipPassable.call(this, x, y);\r\n    }\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.checkHasTileFlag(x, y, 'ship', render);\r\n};\r\n\r\nGame_Map.prototype.renderIsShipPassable = function(x, y, render = 'main', level = 0) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isShipPassable(x, y, render, level);\r\n}\r\n\r\nlet _isAirshipLandOk = Game_Map.prototype.isAirshipLandOk\r\nGame_Map.prototype.isAirshipLandOk = function(x, y, render = false, level = false) {\r\n    if (!this.isTiledMap()) {\r\n        return _isAirshipLandOk.call(this, x, y);\r\n    }\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.checkHasTileFlag(x, y, 'airship', render) && this.checkPassage(x, y, 0x0f, render);\r\n};\r\n\r\nGame_Map.prototype.renderIsAirshipLandOk = function(x, y, render = 'main', level = 0) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isAirshipLandOk(x, y, render, level);\r\n}\r\n\r\nlet _isLadder = Game_Map.prototype.isLadder\r\nGame_Map.prototype.isLadder = function(x, y, render = false, level = false) {\r\n    if (!this.isTiledMap()) {\r\n        return _isLadder.call(this, x, y);\r\n    }\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isValid(x, y) && this.checkHasTileFlag(x, y, 'ladder', render);\r\n};\r\n\r\nGame_Map.prototype.renderIsLadder = function(x, y, render = 'main', level = 0) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isLadder(x, y, render, level);\r\n}\r\n\r\nlet _isBush = Game_Map.prototype.isBush\r\nGame_Map.prototype.isBush = function(x, y, render = false, level = false) {\r\n    if (!this.isTiledMap()) {\r\n        return _isBush.call(this, x, y);\r\n    }\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isValid(x, y) && this.checkHasTileFlag(x, y, 'bush', render);\r\n};\r\n\r\nGame_Map.prototype.renderIsBush = function(x, y, render = 'main', level = 0) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isBush(x, y, render, level);\r\n}\r\n\r\nlet _isCounter = Game_Map.prototype.isCounter\r\nGame_Map.prototype.isCounter = function(x, y, render = false, level = false) {\r\n    if (!this.isTiledMap()) {\r\n        return _isCounter.call(this, x, y);\r\n    }\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isValid(x, y) && this.checkHasTileFlag(x, y, 'counter', render);\r\n};\r\n\r\nGame_Map.prototype.renderIsCounter = function(x, y, render = 'main', level = 0) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isCounter(x, y, render, level);\r\n}\r\n\r\nlet _isDamageFloor = Game_Map.prototype.isDamageFloor\r\nGame_Map.prototype.isDamageFloor = function(x, y, render = false, level = false) {\r\n    if (!this.isTiledMap()) {\r\n        return _isDamageFloor.call(this, x, y);\r\n    }\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isValid(x, y) && this.checkHasTileFlag(x, y, 'damage', render);\r\n};\r\n\r\nGame_Map.prototype.renderIsDamageFloor = function(x, y, render = 'main', level = 0) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isDamageFloor(x, y, render, level);\r\n}\r\n\r\nGame_Map.prototype.isSlipperyFloor = function(x, y, render = false, level = false) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isValid(x, y) && this.checkHasTileFlag(x, y, 'ice', render);\r\n};\r\n\r\nGame_Map.prototype.renderIsSlipperyFloor = function(x, y, render = 'main', level = 0) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isSlipperyFloor(x, y, render, level);\r\n}\r\n\r\nlet _isHealFloor = Game_Map.prototype.isHealFloor\r\nGame_Map.prototype.isHealFloor = function(x, y, render = false, level = false) {\r\n    if(level === false) {\r\n        level = 0;\r\n    }\r\n    return this.isValid(x, y) && this.checkHasTileFlag(x, y, 'heal', render);\r\n};\r\n\r\nGame_Map.prototype.getLayerProperties = function(layer = -1, ignoreHidden = true) {\r\n\tif(layer > -1) {\r\n\t\tif(this.tiledData.layers[layer] && this.tiledData.layers[layer].properties) {\r\n\t\t\treturn Object.assign({}, this.tiledData.layers[layer].properties);\r\n\t\t}\r\n\t\treturn {};\r\n\t}\r\n\tlet layerProperties = {};\r\n\tthis.tiledData.layers.forEach((layerData, i) => {\r\n\t\tif(layerData && layerData.properties) {\r\n            if(!ignoreHidden || !TiledManager.checkLayerHidden(layerData, 'collisions')) {\r\n                layerProperties[i] = Object.assign({}, layerData.properties);\r\n            }\r\n\t\t}\r\n\t});\r\n\treturn layerProperties;\r\n}\r\n\r\nGame_Map.prototype.getTileProperties = function(x, y, layer = -1, ignoreHidden = true) {\r\n    let index = x + this.width() * y;\r\n    \r\n\tif(layer > -1) {\r\n\t\tif(this.tiledData.layers[layer] && (this.tiledData.layers[layer].data || this.tiledData.layers[layer].chunks)) {\r\n\t\t\tlet tileId = TiledManager.extractTileId(this.tiledData.layers[layer], index);\r\n\t\t\tlet tileset = this._getTileset(tileId);\r\n\t\t\tif(tileset && tileset.tileproperties) {\r\n\t\t\t\treturn Object.assign({}, tileset.tileproperties[tileId - tileset.firstgid]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {};\r\n\t}\r\n\tlet tileProperties = {};\r\n\tthis.tiledData.layers.forEach((layerData, i) => {\r\n\t\tif(layerData && (layerData.data || layerData.chunks) && layerData.properties) {\r\n            if(!ignoreHidden || !TiledManager.checkLayerHidden(layerData)) {\r\n                let props = this.getTileProperties(x, y, i);\r\n                if(Object.keys(props).length > 0) {\r\n                    tileProperties[i] = props;\r\n                }\r\n            }\r\n\t\t}\r\n\t});\r\n\treturn tileProperties;\r\n}\r\n\r\n/* Custom vehicles */\r\nlet _createVehicles = Game_Map.prototype.createVehicles\r\nGame_Map.prototype.createVehicles = function() {\r\n    if (!this.isTiledMap()) {\r\n        _createVehicles.call(this);\r\n    }\r\n    this._vehicles = [];\r\n\r\n};\r\n\r\nlet _refreshVehicles = Game_Map.prototype.refereshVehicles\r\nGame_Map.prototype.refereshVehicles = function() {\r\n    if (!this.isTiledMap()) {\r\n        return _refreshVehicles.call(this);\r\n    }\r\n    return TiledManager.refreshVehicles(this._vehicles);\r\n};\r\n\r\nlet _vehicles = Game_Map.prototype.vehicles\r\nGame_Map.prototype.vehicles = function(getNames = false) {\r\n    if (!this.isTiledMap()) {\r\n        return _vehicles.call(this);\r\n    }\r\n    if(getNames) {\r\n        return this._vehicles;\r\n    }\r\n    return TiledManager.getAllVehicles(this._vehicles);\r\n};\r\n\r\nlet _vehicle = Game_Map.prototype.vehicle\r\nGame_Map.prototype.vehicle = function(type) {\r\n    if (!this.isTiledMap()) {\r\n        return _vehicles.call(this, type);\r\n    }\r\n    return TiledManager.getVehicle(type);\r\n}\r\n\r\nlet _boat = Game_Map.prototype.boat\r\nGame_Map.prototype.boat = function() {\r\n    if (!this.isTiledMap()) {\r\n        return _boat.call(this);\r\n    }\r\n    return TiledManager.getVehicle('boat');\r\n};\r\n\r\nlet _ship = Game_Map.prototype.ship\r\nGame_Map.prototype.ship = function() {\r\n    if (!this.isTiledMap()) {\r\n        return _ship.call(this);\r\n    }\r\n    return TiledManager.getVehicle('ship');\r\n};\r\n\r\nlet _airship = Game_Map.prototype.airship\r\nGame_Map.prototype.airship = function() {\r\n    if (!this.isTiledMap()) {\r\n        return _airship.call(this);\r\n    }\r\n    return TiledManager.getVehicle('airship');\r\n};\r\n\r\nlet _updateVehicles = Game_Map.prototype.updateVehicles\r\nGame_Map.prototype.updateVehicles = function() {\r\n    if (!this.isTiledMap()) {\r\n        _updateVehicles.call(this);\r\n    }\r\n    TiledManager.updateVehicles(this._vehicles);\r\n};\r\n\r\nGame_Map.prototype.waypoint = function(waypoint) {\r\n    if(this._waypoints[waypoint]) {\r\n        return this._waypoints[waypoint];\r\n    }\r\n    return null;\r\n}\r\n\r\nlet _update = Game_Map.prototype.update\r\nGame_Map.prototype.update = function(sceneActive) {\r\n    this.setLayerProperties();\r\n    _update.call(this, sceneActive);\r\n}\r\n\r\nGame_Map.prototype.getLayerProperties = function(layerId) {\r\n    return Object.assign({}, this._layerProperties[layerId]);\r\n}\r\n\r\nGame_Map.prototype.setLayerProperties = function() {\r\n    this._layerProperties.forEach((props, i) => {\r\n        let layer = this.tiledData.layers[i];\r\n        if(props.transition) {\r\n            props.isShown = !TiledManager.checkLayerHidden(layer);\r\n            props.transitionPhase = Math.max(0, Math.min(props.transition, props.transitionPhase + (props.isShown ? 1 : -1)));\r\n        }\r\n        if(props.autoSpeedX) {\r\n            props.autoX+= props.autoSpeedX\r\n            if(props.autoDuration || props.imageWidth) {\r\n                while(props.autoX < 0) {\r\n                    props.autoX+= props.autoDuration || props.imageWidth;\r\n                }\r\n                while(props.autoX > props.imageWidth) {\r\n                    props.autoX-= props.autoDuration || props.imageWidth;\r\n                }\r\n            }\r\n        }\r\n        if(props.autoSpeedY) {\r\n            props.autoY+= props.autoSpeedY\r\n            if(props.imageHeight) {\r\n                while(props.autoY < 0) {\r\n                    props.autoY+= props.autoDuration || props.imageHeight;\r\n                }\r\n                while(props.autoY > props.imageHeight) {\r\n                    props.autoY-= props.autoDuration || props.imageHeight;\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Game_Map.js","\r\nGame_Screen.prototype.startFlashForHeal = function() {\r\n    this.startFlash([128, 192, 255, 128], 8);\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Game_Screen.js","let pluginParams = PluginManager.parameters(\"YED_Tiled\");\r\n\r\nGame_CharacterBase.prototype.screenZ = function () {\r\n    if (this._priorityType == 0) {\r\n        return parseInt(pluginParams[\"Z - Below Player\"]);\r\n    }\r\n    if (this._priorityType == 2) {\r\n        return parseInt(pluginParams[\"Z - Above Player\"]);\r\n    }\r\n    return parseInt(pluginParams[\"Z - Player\"]);\r\n};\r\n\r\nlet _distancePerFrame = Game_CharacterBase.prototype.distancePerFrame;\r\nGame_CharacterBase.prototype.distancePerFrame = function () {\r\n    let distance = _distancePerFrame.call(this);\r\n    return distance * (48 / Math.min($gameMap.tileWidth(), $gameMap.tileHeight()));\r\n};\r\n\r\nlet _refreshBushDepth = Game_CharacterBase.prototype.refreshBushDepth;\r\nGame_CharacterBase.prototype.refreshBushDepth = function() {\r\n    if(!this.hasOwnProperty('_bushDepth')) {\r\n        this._bushDepth = 0;\r\n    }\r\n    if(!$gameMap.isTiledMap() || $gameMap.isTiledInitialized()) {\r\n        _refreshBushDepth.call(this);\r\n    } else {\r\n        $gameMap.setRefreshDepth(this);\r\n    }\r\n};\r\n\r\nlet _updateMove = Game_CharacterBase.prototype.updateMove;\r\nGame_CharacterBase.prototype.updateMove = function() {\r\n    var hori = (this._realX > this._x ? 4 : (this._realX < this._x ? 6 : 0))\r\n    var vert = (this._realY > this._y ? 8 : (this._realY < this._y ? 2 : 0))\r\n    var d = hori + vert\r\n    _updateMove.call(this);\r\n    if(!this.isMoving() || pluginParams[\"Position Height - Always Check On Move Update\"].toLowerCase() === \"true\") {\r\n        let newLocationHeight = $gameMap.checkPositionHeight(this._x, this._y);\r\n        if(newLocationHeight > -1) {\r\n            this._locationHeight = newLocationHeight;\r\n        }\r\n    }\r\n    if(!this.isMoving()) {\r\n        TiledManager.triggerListener(this, 'stopmovement', {\r\n            direction: d\r\n        })\r\n        if($gameMap.isSlipperyFloor(this._x, this._y)) {\r\n            TiledManager.triggerListener(this, 'slipperyfloor', {\r\n                direction: d\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nGame_CharacterBase.prototype.locationHeight = function() {\r\n\treturn this._locationHeight || 0\r\n}\r\n\r\nlet _isCollideWithVehicles = Game_CharacterBase.prototype.isCollidedWithVehicles\r\nGame_CharacterBase.prototype.isCollidedWithVehicles = function(x, y) {\r\n    if(!_isCollideWithVehicles.call(this, x, y)) {\r\n        let vehicles = $gameMap.vehicles();\r\n        for(let i = 0; i < vehicles.length; i++) {\r\n            if(!(vehicles[i].vehicleData && (!vehicles[i].vehicleData.hasOwnProperty('hasCollision') || vehicles[i].vehicleData.hasCollision === 'true' || vehicles[i].vehicleData.hasCollision === true)) || vehicles[i].posNt(x, y)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    return true;\r\n};\r\n\r\nGame_CharacterBase.prototype.updateScroll = function(lastScrolledX, lastScrolledY) {\r\n    var x1 = lastScrolledX;\r\n    var y1 = lastScrolledY;\r\n    var x2 = this.scrolledX();\r\n    var y2 = this.scrolledY();\r\n    if (y2 > y1 && y2 > this.centerY()) {\r\n        $gameMap.scrollDown(y2 - y1);\r\n    }\r\n    if (x2 < x1 && x2 < this.centerX()) {\r\n        $gameMap.scrollLeft(x1 - x2);\r\n    }\r\n    if (x2 > x1 && x2 > this.centerX()) {\r\n        $gameMap.scrollRight(x2 - x1);\r\n    }\r\n    if (y2 < y1 && y2 < this.centerY()) {\r\n        $gameMap.scrollUp(y1 - y2);\r\n    }\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Game_CharacterBase.js","// Constants\r\nlet pluginParams = PluginManager.parameters(\"YED_Tiled\");\r\n\r\nlet _checkFloorEffect = Game_Actor.prototype.checkFloorEffect;\r\nGame_Actor.prototype.checkFloorEffect = function() {\r\n    _checkFloorEffect.call(this);\r\n    if ($gamePlayer.isOnHealFloor()) {\r\n        this.executeFloorHeal();\r\n    }\r\n}\r\n\r\nGame_Actor.prototype.executeFloorHeal = function() {\r\n    var heal = Math.floor(this.basicFloorHeal() * this.fdr);\r\n    heal = Math.min(heal, this.maxFloorHeal());\r\n    this.gainHp(heal);\r\n    if (heal > 0) {\r\n        this.performMapHeal();\r\n    }\r\n};\r\n\r\nGame_Actor.prototype._getFloorHPCalculation = function(type = 'damage') {\r\n    let typeName = type.slice(0, 1).toUpperCase() + type.slice(1).toLowerCase();\r\n    let floorHP = [];\r\n    for(var layerId = 0; layerId < $gameMap.tiledData.layers; layerId++) {\r\n        let layerData = $gameMap.tiledData.layers[layerId];\r\n        if(!layerData.properties) {\r\n            return;\r\n        }\r\n        let level = parseInt(layerData.properties.level) || 0;\r\n        if(level !== $gameMap.currentMapLevel) {\r\n            return;\r\n        }\r\n        if(TiledManager.checkLayerHidden(layerData)) {\r\n            return;\r\n        }\r\n        let tile = Game_Map.prototype.getTileProperties(x, y, layerId);\r\n        if(!!tile.properties && !!tile.properties['floor' + typeName]) {\r\n            floorHP.push(layerData.properties['floor' + typeName]);\r\n        }\r\n    }\r\n    let actualHP = 0;\r\n    switch((pluginParams[\"Floor HP Calculation\"] || '').toLowerCase()) {\r\n        case 'sum':\r\n            floorHP.forEach(hp => {\r\n                actualHP+= hp;\r\n            })\r\n            break;\r\n        case 'average':\r\n            floorHP.forEach(hp => {\r\n                actualHP+= hp;\r\n            })\r\n            actualHP = Math.round(actualHP / floorHP.length);\r\n            break;\r\n        case 'top':\r\n        default:\r\n            actualHP = floorHP.pop();\r\n            break;\r\n    }\r\n    return actualHP;\r\n}\r\n\r\nGame_Actor.prototype.basicFloorDamage = function() {\r\n    let actualDamage = this._getFloorHPCalculation('damage');\r\n    return actualDamage || parseInt(pluginParams[\"Basic Floor Damage\"]) || 10;\r\n};\r\n\r\nGame_Actor.prototype.basicFloorHeal = function() {\r\n    let actualHeal = this._getFloorHPCalculation('heal');\r\n    return actualHeal || parseInt(pluginParams[\"Basic Floor Heal\"]) || 10;\r\n};\r\n\r\nGame_Actor.prototype.maxFloorHeal = function() {\r\n    return Math.max(this.mhp - this.hp, 0);\r\n};\r\n\r\nGame_Actor.prototype.performMapHeal = function() {\r\n    if (!$gameParty.inBattle()) {\r\n        $gameScreen.startFlashForHeal();\r\n    }\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Game_Actor.js","let _initMembers = Game_Player.prototype.initMembers;\r\nGame_Player.prototype.initMembers = function() {\r\n    _initMembers.call(this);\r\n    this._newWaypoint = '';\r\n}\r\n\r\nlet _checkEventTriggerHere = Game_Player.prototype.checkEventTriggerHere;\r\nGame_Player.prototype.checkEventTriggerHere = function (triggers) {\r\n    _checkEventTriggerHere.call(this, triggers);\r\n    this._checkMapLevelChangingHere();\r\n};\r\n\r\nGame_Player.prototype._checkMapLevelChangingHere = function () {\r\n    let oldLevel = $gameMap.currentMapLevel;\r\n    $gameMap.checkMapLevelChanging(this.x, this.y);\r\n    TiledManager.triggerListener(this, 'levelchanged', {\r\n        oldLevel,\r\n        newLevel: $gameMap.currentMapLevel\r\n    })\r\n};\r\n\r\nGame_Player.prototype.isOnHealFloor = function() {\r\n    return $gameMap.isHealFloor(this.x, this.y) && !this.isInAirship();\r\n};\r\n\r\nlet _getOnVehicle = Game_Player.prototype.getOnVehicle\r\nGame_Player.prototype.getOnVehicle = function() {\r\n    if(!$gameMap.isTiledMap()) {\r\n        return _getOnVehicle.call(this);\r\n    }\r\n    var direction = this.direction();\r\n    var x1 = this.x;\r\n    var y1 = this.y;\r\n    var x2 = $gameMap.roundXWithDirection(x1, direction);\r\n    var y2 = $gameMap.roundYWithDirection(y1, direction);\r\n    if ($gameMap.airship().pos(x1, y1)) {\r\n        this._vehicleType = 'airship';\r\n    } else if ($gameMap.ship().pos(x2, y2)) {\r\n        this._vehicleType = 'ship';\r\n    } else if ($gameMap.boat().pos(x2, y2)) {\r\n        this._vehicleType = 'boat';\r\n    } else {\r\n        let vehicles = $gameMap.vehicles(true);\r\n        vehicles.forEach(vehicleName => {\r\n            let vehicle = $gameMap.vehicle(vehicleName);\r\n            if(vehicle.vehicleData) {\r\n                if(!vehicle.vehicleData.hasOwnProperty('hasCollision') || vehicle.vehicleData.hasCollision === 'true' || vehicle.vehicleData.hasCollision === true) {\r\n                    if(vehicle.pos(x2, y2)) {\r\n                        this._vehicleType = vehicleName;\r\n                    }\r\n                } else {\r\n                    if(vehicle.pos(x1, y1)) {\r\n                        this._vehicleType = vehicleName;\r\n                    }\r\n                }\r\n            } else if(vehicle.pos(x2, y2)) {\r\n                this._vehicleType = vehicleName;\r\n            }\r\n        })\r\n    }\r\n    if (this.isInVehicle()) {\r\n        this._vehicleGettingOn = true;\r\n        if (!this.isInAirship()) {\r\n            this.forceMoveForward();\r\n        }\r\n        this.gatherFollowers();\r\n    }\r\n    return this._vehicleGettingOn;\r\n};\r\n\r\nlet _isInVehicle = Game_Player.prototype.isInVehicle\r\nGame_Player.prototype.isInVehicle = function() {\r\n    if(!$gameMap.isTiledMap()) {\r\n        return _isInVehicle.call(this);\r\n    }\r\n    return $gameMap.vehicles(true).indexOf(this._vehicleType) > -1;\r\n};\r\n\r\nlet _reserveTransfer = Game_Player.prototype.reserveTransfer\r\nGame_Player.prototype.reserveTransfer = function(mapId, x, y, d, fadeType, waypoint = '') {\r\n    _reserveTransfer.call(this, mapId, x, y, d, fadeType);\r\n    this._newWaypoint = waypoint;\r\n}\r\n\r\nGame_Player.prototype.performTransfer = function() {\r\n    if (this.isTransferring()) {\r\n        this.setDirection(this._newDirection);\r\n        if (this._newMapId !== $gameMap.mapId() || this._needsMapReload) {\r\n            $gameMap.setup(this._newMapId);\r\n            this._needsMapReload = false;\r\n        }\r\n        let newX = this._newX;\r\n        let newY = this._newY;\r\n        if($gameMap.isTiledMap()) {\r\n            if(this._newWaypoint) {\r\n                let waypoint = $gameMap.waypoint(this._newWaypoint);\r\n                if(waypoint) {\r\n                    newX = waypoint.x;\r\n                    newY = waypoint.y;\r\n                }\r\n            }\r\n            let offsets = $gameMap.offsets();\r\n            if(offsets && offsets.x && offsets.y) {\r\n                newX-= offsets.x;\r\n                newY-= offsets.y;\r\n            }\r\n        }\r\n        this.locate(newX, newY);\r\n        this.refresh();\r\n        this.clearTransferInfo();\r\n    }\r\n};\r\n\r\nlet _clearTransferInfo = Game_Player.prototype.clearTransferInfo;\r\nGame_Player.prototype.clearTransferInfo = function() {\r\n    _clearTransferInfo.call(this);\r\n    this._newWaypoint = '';\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Game_Player.js","let _initialize = Game_Vehicle.prototype.initialize\r\nGame_Vehicle.prototype.initialize = function(type, vehicleData = false) {\r\n    if(vehicleData) {\r\n        this.vehicleData = vehicleData;\r\n    }\r\n    _initialize.call(this, type);\r\n};\r\n\r\nlet _initMoveSpeed = Game_Vehicle.prototype.initMoveSpeed\r\nGame_Vehicle.prototype.initMoveSpeed = function() {\r\n    _initMoveSpeed.call(this);\r\n    if(!!this.vehicleData && this.vehicleData.moveSpeed) {\r\n        this.setMoveSpeed(parseInt(this.vehicleData.moveSpeed));\r\n    }\r\n};\r\n\r\nlet _vehicle = Game_Vehicle.prototype.vehicle\r\nGame_Vehicle.prototype.vehicle = function() {\r\n    var vehicleData = _vehicle.call(this);\r\n    if(!vehicleData && !!this.vehicleData) {\r\n        return this.vehicleData;\r\n    }\r\n    return vehicleData;\r\n};\r\n\r\nlet _isMapPassable = Game_Vehicle.prototype.isMapPassable\r\nGame_Vehicle.prototype.isMapPassable = function(x, y, d, render = false) {\r\n    if(!$gameMap.isTiledMap()) {\r\n        return _isMapPassable.call(this, x, y, d);\r\n    }\r\n    var x2 = $gameMap.roundXWithDirection(x, d);\r\n    var y2 = $gameMap.roundYWithDirection(y, d);\r\n    if (this.isBoat()) {\r\n        return $gameMap.isBoatPassable(x2, y2, render);\r\n    } else if (this.isShip()) {\r\n        return $gameMap.isShipPassable(x2, y2, render);\r\n    } else if (this.isAirship()) {\r\n        return true;\r\n    } else {\r\n        var vehicleData = this.vehicle();\r\n        if(!!vehicleData) {\r\n            if(!!vehicleData.tileFlag) {\r\n                return $gameMap.checkHasTileFlag(x2, y2, vehicleData.tileFlag, render);\r\n            }\r\n            if(vehicleData.tileFlag === '') {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n};\r\n\r\nGame_Vehicle.prototype.loadSystemSettings = function() {\r\n    var vehicle = (window.$dataSystem ? this.vehicle() : null);\r\n    if(vehicle) {\r\n        this._mapId = vehicle.startMapId;\r\n        this.setPosition(vehicle.startX, vehicle.startY);\r\n        this.setImage(vehicle.characterName, vehicle.characterIndex);\r\n    }\r\n};\r\n\r\nlet _resetDirection = Game_Vehicle.prototype.resetDirection\r\nGame_Vehicle.prototype.resetDirection = function() {\r\n    if(!!this.vehicleData && !!this.vehicleData.direction) {\r\n        this.setDirection(parseInt(this.vehicleData.direction));\r\n    } else {\r\n        _resetDirection.call(this)\r\n    }\r\n};\r\n\r\nGame_Vehicle.prototype.getOff = function() {\r\n    this._driving = false;\r\n    this.setWalkAnime(false);\r\n    this.setStepAnime(false);\r\n    if(!this.vehicleData || !this.vehicleData.hasOwnProperty('resetDirection') || this.vehicleData.resetDirection === 'true') {\r\n        this.resetDirection();\r\n    }\r\n    $gameSystem.replayWalkingBgm();\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Game_Vehicle.js","let _pluginCommand = Game_Interpreter.prototype.pluginCommand\r\nGame_Interpreter.prototype.pluginCommand = function(command, args) {\r\n    _pluginCommand.call(this, command, args);\r\n    TiledManager.pluginCommand.call(this, command, args);\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Game_Interpreter.js","let _update = Sprite_Character.prototype.update\r\nSprite_Character.prototype.update = function() {\r\n\t_update.call(this);\r\n\tthis.locationHeight = this._character.locationHeight();\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Sprite_Character.js","import { TiledTilemap } from \"./TiledTilemap\";\r\n\r\nlet _initialize = Spriteset_Battle.prototype.initialize\r\nSpriteset_Battle.prototype.initialize = function() {\r\n    this._parallaxContainers = {};\r\n    _initialize.call(this);\r\n}\r\n\r\nlet _createTilemap = Spriteset_Map.prototype.createTilemap;\r\nSpriteset_Map.prototype.createTilemap = function () {\r\n    if (!$gameMap.isTiledMap()) {\r\n        _createTilemap.call(this);\r\n        return;\r\n    }\r\n    this._tilemap = new TiledTilemap($gameMap.tiledData);\r\n    this._tilemap.horizontalWrap = $gameMap.isLoopHorizontal();\r\n    this._tilemap.verticalWrap = $gameMap.isLoopVertical();\r\n    this.loadTileset();\r\n    this._baseSprite.addChild(this._tilemap);\r\n};\r\n\r\nlet _loadTileset = Spriteset_Map.prototype.loadTileset;\r\nSpriteset_Map.prototype.loadTileset = function () {\r\n    if (!$gameMap.isTiledMap()) {\r\n        _loadTileset.call(this);\r\n        return;\r\n    }\r\n\r\n    let i = 0;\r\n    for (let tileset of $gameMap.tiledData.tilesets) {\r\n        if(tileset.properties && tileset.properties.ignoreLoading) {\r\n            continue;\r\n        }\r\n        this._tilemap.bitmaps[i] = ImageManager.loadParserTileset(tileset.image, 0);\r\n        i++;\r\n    }\r\n    this._tilemap.refreshTileset();\r\n    this._tileset = $gameMap.tiledData.tilesets;\r\n};\r\n\r\nlet _update = Spriteset_Map.prototype.update;\r\nSpriteset_Map.prototype.update = function () {\r\n    _update.call(this);\r\n    //Disabed updateHideOnLevel, since it got moved to the general layer hide functions\r\n    //this._updateHideOnLevel();\r\n    this._updateHideOnSpecial();\r\n    this._tilemap.updateParallax();\r\n};\r\n\r\nSpriteset_Map.prototype.updateTileset = function () {\r\n    if (this._tileset !== $gameMap.tiledData.tilesets) {\r\n        this.loadTileset();\r\n    }\r\n};\r\n\r\nSpriteset_Map.prototype._updateHideOnLevel = function () {\r\n    this._tilemap.hideOnLevel($gameMap.currentMapLevel);\r\n};\r\n\r\nSpriteset_Map.prototype._updateHideOnSpecial = function () {\r\n    if($gamePlayer && $gameMap) {\r\n        this._tilemap.hideOnSpecial();\r\n    }\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Spriteset_Map.js"],"sourceRoot":""}